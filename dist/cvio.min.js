!function t(e,s,i){function r(o,h){if(!s[o]){if(!e[o]){var a="function"==typeof require&&require;if(!h&&a)return a(o,!0);if(n)return n(o,!0);throw new Error("Cannot find module '"+o+"'")}var _=s[o]={exports:{}};e[o][0].call(_.exports,function(t){var s=e[o][1][t];return r(s||t)},_,_.exports,t,e,s,i)}return s[o].exports}for(var n="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,s){!function(t,s){void 0!==e&&e.exports?e.exports.browser=s():"function"==typeof define&&define.amd?define(s):this.bowser=s()}(0,function(){function t(t){function s(e){var s=t.match(e);return s&&s.length>1&&s[1]||""}var i,r=s(/(ipod|iphone|ipad)/i).toLowerCase(),n=/like android/i.test(t),o=!n&&/android/i.test(t),h=s(/edge\/(\d+(\.\d+)?)/i),a=s(/version\/(\d+(\.\d+)?)/i),_=/tablet/i.test(t),c=!_&&/[^-]mobi/i.test(t);/opera|opr/i.test(t)?i={name:"Opera",opera:e,version:a||s(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(t)?(i={name:"Windows Phone",windowsphone:e},h?(i.msedge=e,i.version=h):(i.msie=e,i.version=s(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(t)?i={name:"Internet Explorer",msie:e,version:s(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(t)?i={name:"Microsoft Edge",msedge:e,version:h}:/chrome|crios|crmo/i.test(t)?i={name:"Chrome",chrome:e,version:s(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:r?(i={name:"iphone"==r?"iPhone":"ipad"==r?"iPad":"iPod"},a&&(i.version=a)):/sailfish/i.test(t)?i={name:"Sailfish",sailfish:e,version:s(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(t)?i={name:"SeaMonkey",seamonkey:e,version:s(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(t)?(i={name:"Firefox",firefox:e,version:s(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(t)&&(i.firefoxos=e)):/silk/i.test(t)?i={name:"Amazon Silk",silk:e,version:s(/silk\/(\d+(\.\d+)?)/i)}:o?i={name:"Android",version:a}:/phantom/i.test(t)?i={name:"PhantomJS",phantom:e,version:s(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(t)||/rim\stablet/i.test(t)?i={name:"BlackBerry",blackberry:e,version:a||s(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(t)?(i={name:"WebOS",webos:e,version:a||s(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(t)&&(i.touchpad=e)):i=/bada/i.test(t)?{name:"Bada",bada:e,version:s(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(t)?{name:"Tizen",tizen:e,version:s(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||a}:/safari/i.test(t)?{name:"Safari",safari:e,version:a}:{name:s(/^(.*)\/(.*) /),version:function(e){var s=t.match(e);return s&&s.length>1&&s[2]||""}(/^(.*)\/(.*) /)},!i.msedge&&/(apple)?webkit/i.test(t)?(i.name=i.name||"Webkit",i.webkit=e,!i.version&&a&&(i.version=a)):!i.opera&&/gecko\//i.test(t)&&(i.name=i.name||"Gecko",i.gecko=e,i.version=i.version||s(/gecko\/(\d+(\.\d+)?)/i)),i.msedge||!o&&!i.silk?r&&(i[r]=e,i.ios=e):i.android=e;var u="";i.windowsphone?u=s(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):r?(u=s(/os (\d+([_\s]\d+)*) like mac os x/i),u=u.replace(/[_\s]/g,".")):o?u=s(/android[ \/-](\d+(\.\d+)*)/i):i.webos?u=s(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):i.blackberry?u=s(/rim\stablet\sos\s(\d+(\.\d+)*)/i):i.bada?u=s(/bada\/(\d+(\.\d+)*)/i):i.tizen&&(u=s(/tizen[\/\s](\d+(\.\d+)*)/i)),u&&(i.osversion=u);var l=u.split(".")[0];return _||"ipad"==r||o&&(3==l||4==l&&!c)||i.silk?i.tablet=e:(c||"iphone"==r||"ipod"==r||o||i.blackberry||i.webos||i.bada)&&(i.mobile=e),i.msedge||i.msie&&i.version>=10||i.chrome&&i.version>=20||i.firefox&&i.version>=20||i.safari&&i.version>=6||i.opera&&i.version>=10||i.ios&&i.osversion&&i.osversion.split(".")[0]>=6||i.blackberry&&i.version>=10.1?i.a=e:i.msie&&i.version<10||i.chrome&&i.version<20||i.firefox&&i.version<20||i.safari&&i.version<6||i.opera&&i.version<10||i.ios&&i.osversion&&i.osversion.split(".")[0]<6?i.c=e:i.x=e,i}var e=!0,s=t("undefined"!=typeof navigator?navigator.userAgent:"");return s.test=function(t){for(var e=0;e<t.length;++e){var i=t[e];if("string"==typeof i&&i in s)return!0}return!1},s._detect=t,s})},{}],2:[function(t,e,s){(function(i){function r(){return!("undefined"==typeof window||!window||void 0===window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function n(t){var e=this.useColors;if(t[0]=(e?"%c":"")+this.namespace+(e?" %c":" ")+t[0]+(e?"%c ":" ")+"+"+s.humanize(this.diff),e){var i="color: "+this.color;t.splice(1,0,i,"color: inherit");var r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,function(t){"%%"!==t&&(r++,"%c"===t&&(n=r))}),t.splice(n,0,i)}}function o(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function h(t){try{null==t?s.storage.removeItem("debug"):s.storage.debug=t}catch(t){}}function a(){var t;try{t=s.storage.debug}catch(t){}return!t&&void 0!==i&&"env"in i&&(t=i.env.DEBUG),t}s=e.exports=t("./debug"),s.log=o,s.formatArgs=n,s.save=h,s.load=a,s.useColors=r,s.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),s.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],s.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}},s.enable(a())}).call(this,t("pBGvAp"))},{"./debug":3,pBGvAp:16}],3:[function(t,e,s){function i(t){var e,i=0;for(e in t)i=(i<<5)-i+t.charCodeAt(e),i|=0;return s.colors[Math.abs(i)%s.colors.length]}function r(t){function e(){if(e.enabled){var t=e,i=+new Date,r=i-(_||i);t.diff=r,t.prev=_,t.curr=i,_=i;for(var n=new Array(arguments.length),o=0;o<n.length;o++)n[o]=arguments[o];n[0]=s.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var h=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,function(e,i){if("%%"===e)return e;h++;var r=s.formatters[i];if("function"==typeof r){var o=n[h];e=r.call(t,o),n.splice(h,1),h--}return e}),s.formatArgs.call(t,n);(e.log||s.log||console.log.bind(console)).apply(t,n)}}return e.namespace=t,e.enabled=s.enabled(t),e.useColors=s.useColors(),e.color=i(t),"function"==typeof s.init&&s.init(e),e}function n(t){s.save(t),s.names=[],s.skips=[];for(var e=("string"==typeof t?t:"").split(/[\s,]+/),i=e.length,r=0;r<i;r++)e[r]&&(t=e[r].replace(/\*/g,".*?"),"-"===t[0]?s.skips.push(new RegExp("^"+t.substr(1)+"$")):s.names.push(new RegExp("^"+t+"$")))}function o(){s.enable("")}function h(t){var e,i;for(e=0,i=s.skips.length;e<i;e++)if(s.skips[e].test(t))return!1;for(e=0,i=s.names.length;e<i;e++)if(s.names[e].test(t))return!0;return!1}function a(t){return t instanceof Error?t.stack||t.message:t}s=e.exports=r.debug=r.default=r,s.coerce=a,s.disable=o,s.enable=n,s.enabled=h,s.humanize=t("ms"),s.names=[],s.skips=[],s.formatters={};var _},{ms:4}],4:[function(t,e,s){function i(t){if(t=String(t),!(t.length>1e4)){var e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(t);if(e){var s=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return s*u;case"days":case"day":case"d":return s*c;case"hours":case"hour":case"hrs":case"hr":case"h":return s*_;case"minutes":case"minute":case"mins":case"min":case"m":return s*a;case"seconds":case"second":case"secs":case"sec":case"s":return s*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}function r(t){return t>=c?Math.round(t/c)+"d":t>=_?Math.round(t/_)+"h":t>=a?Math.round(t/a)+"m":t>=h?Math.round(t/h)+"s":t+"ms"}function n(t){return o(t,c,"day")||o(t,_,"hour")||o(t,a,"minute")||o(t,h,"second")||t+" ms"}function o(t,e,s){if(!(t<e))return t<1.5*e?Math.floor(t/e)+" "+s:Math.ceil(t/e)+" "+s+"s"}var h=1e3,a=60*h,_=60*a,c=24*_,u=365.25*c;e.exports=function(t,e){e=e||{};var s=typeof t;if("string"===s&&t.length>0)return i(t);if("number"===s&&!1===isNaN(t))return e.long?n(t):r(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},{}],5:[function(t,e,s){var i=t("./lib/util"),r=t("./lib/keys"),n=t("./lib/kbdutil"),o=t("./lib/input"),h=t("./lib/websock"),a=t("./lib/base64"),_=t("./lib/des"),c=t("./lib/tinf"),u=t("./lib/display"),l=t("./lib/rfb"),d={Util:i,Keys:r,KbdUtil:n,Input:o,Websock:h,Base64:a,DES:_,TINF:c,Display:u,RFB:l};e.exports=d},{"./lib/base64":6,"./lib/des":7,"./lib/display":8,"./lib/input":9,"./lib/kbdutil":10,"./lib/keys":11,"./lib/rfb":12,"./lib/tinf":13,"./lib/util":14,"./lib/websock":15}],6:[function(t,e,s){var i=t("debug")("noVNC:ERROR:Base64");i.log=console.warn.bind(console);var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),n=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];e.exports={encode:function(t){for(var e="",s=t.length,i=s%3,n=0;n<s-2;n+=3)e+=r[t[n]>>2],e+=r[((3&t[n])<<4)+(t[n+1]>>4)],e+=r[((15&t[n+1])<<2)+(t[n+2]>>6)],e+=r[63&t[n+2]];var o=0;return 2===i?(o=s-i,e+=r[t[o]>>2],e+=r[((3&t[o])<<4)+(t[o+1]>>4)],e+=r[(15&t[o+1])<<2],e+=r[64]):1===i&&(o=s-i,e+=r[t[o]>>2],e+=r[(3&t[o])<<4],e+=r[64],e+=r[64]),e},decode:function(t,e){e=void 0!==e?e:0;var s,r,o=0,h=0,a=t.indexOf("=")-e;a<0&&(a=t.length-e),r=3*(a>>2)+Math.floor(a%4/1.5),s=new Array(r);for(var _=0,c=e;c<t.length;c++){var u=n[127&t.charCodeAt(c)],l="="===t.charAt(c);-1!==u?(h=h<<6|u,(o+=6)>=8&&(o-=8,l||(s[_++]=h>>o&255),h&=(1<<o)-1)):i("decode() | illegal character code "+t.charCodeAt(c)+" at position "+c)}if(o){i("decode() | corrupted Base64 string");var d=new Error("Corrupted Base64 string");throw d.name="Base64-Error",d}return s}}},{debug:2}],7:[function(t,e,s){function i(t){var e,s,i,r,n,o,h,a,_,c,u=[],l=[],d=[];for(s=0,i=56;s<56;++s,i-=8)i+=i<-5?65:i<-3?31:i<-1?63:27===i?35:0,r=7&i,u[s]=0!=(t[i>>>3]&1<<r)?1:0;for(e=0;e<16;++e){for(r=e<<1,n=r+1,d[r]=d[n]=0,o=28;o<59;o+=28)for(s=o-28;s<o;++s)i=s+w[e],l[s]=i<o?u[i]:u[i-28];for(s=0;s<24;++s)0!==l[m[s]]&&(d[r]|=1<<23-s),0!==l[m[s+24]]&&(d[n]|=1<<23-s)}for(e=0,_=0,c=0;e<16;++e)h=d[_++],a=d[_++],k[c]=(16515072&h)<<6,k[c]|=(4032&h)<<10,k[c]|=(16515072&a)>>>10,k[c]|=(4032&a)>>>6,++c,k[c]=(258048&h)<<12,k[c]|=(63&h)<<16,k[c]|=(258048&a)>>>4,k[c]|=63&a,++c}function r(t){var e,s,i,r,n=0,o=t.slice(),h=0;for(s=o[n++]<<24|o[n++]<<16|o[n++]<<8|o[n++],i=o[n++]<<24|o[n++]<<16|o[n++]<<8|o[n++],r=252645135&(s>>>4^i),i^=r,s^=r<<4,r=65535&(s>>>16^i),i^=r,s^=r<<16,r=858993459&(i>>>2^s),s^=r,i^=r<<2,r=16711935&(i>>>8^s),s^=r,i^=r<<8,i=i<<1|i>>>31&1,r=2863311530&(s^i),s^=r,i^=r,s=s<<1|s>>>31&1,n=0;n<8;++n)r=i<<28|i>>>4,r^=k[h++],e=v[63&r],e|=g[r>>>8&63],e|=f[r>>>16&63],e|=l[r>>>24&63],r=i^k[h++],e|=y[63&r],e|=b[r>>>8&63],e|=p[r>>>16&63],e|=d[r>>>24&63],s^=e,r=s<<28|s>>>4,r^=k[h++],e=v[63&r],e|=g[r>>>8&63],e|=f[r>>>16&63],e|=l[r>>>24&63],r=s^k[h++],e|=y[63&r],e|=b[r>>>8&63],e|=p[r>>>16&63],e|=d[r>>>24&63],i^=e;for(i=i<<31|i>>>1,r=2863311530&(s^i),s^=r,i^=r,s=s<<31|s>>>1,r=16711935&(s>>>8^i),i^=r,s^=r<<8,r=858993459&(s>>>2^i),i^=r,s^=r<<2,r=65535&(i>>>16^s),s^=r,i^=r<<16,r=252645135&(i>>>4^s),s^=r,i^=r<<4,r=[i,s],n=0;n<8;n++)o[n]=(r[n>>>2]>>>8*(3-n%4))%256,o[n]<0&&(o[n]+=256);return o}function n(t){return r(t.slice(0,8)).concat(r(t.slice(8,16)))}var o,h,a,_,c,u,l,d,f,p,g,b,v,y,m=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31],w=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],k=[];o=65536,h=1<<24,a=o|h,_=4,c=1024,u=_|c,l=[a|c,0,0|o,a|u,a|_,o|u,0|_,0|o,0|c,a|c,a|u,0|c,h|u,a|_,0|h,0|_,0|u,h|c,h|c,o|c,o|c,0|a,0|a,h|u,o|_,h|_,h|_,o|_,0,0|u,o|u,0|h,0|o,a|u,0|_,0|a,a|c,0|h,0|h,0|c,a|_,0|o,o|c,h|_,0|c,0|_,h|u,o|u,a|u,o|_,0|a,h|u,h|_,0|u,o|u,a|c,0|u,h|c,h|c,0,o|_,o|c,0,a|_],o=1<<20,h=1<<31,a=o|h,_=32,c=32768,u=_|c,d=[a|u,h|c,0|c,o|u,0|o,0|_,a|_,h|u,h|_,a|u,a|c,0|h,h|c,0|o,0|_,a|_,o|c,o|_,h|u,0,0|h,0|c,o|u,0|a,o|_,h|_,0,o|c,0|u,a|c,0|a,0|u,0,o|u,a|_,0|o,h|u,0|a,a|c,0|c,0|a,h|c,0|_,a|u,o|u,0|_,0|c,0|h,0|u,a|c,0|o,h|_,o|_,h|u,h|_,o|_,o|c,0,h|c,0|u,0|h,a|_,a|u,o|c],o=1<<17,h=1<<27,a=o|h,_=8,c=512,u=_|c,f=[0|u,a|c,0,a|_,h|c,0,o|u,h|c,o|_,h|_,h|_,0|o,a|u,o|_,0|a,0|u,0|h,0|_,a|c,0|c,o|c,0|a,a|_,o|u,h|u,o|c,0|o,h|u,0|_,a|u,0|c,0|h,a|c,0|h,o|_,0|u,0|o,a|c,h|c,0,0|c,o|_,a|u,h|c,h|_,0|c,0,a|_,h|u,0|o,0|h,a|u,0|_,o|u,o|c,h|_,0|a,h|u,0|u,0|a,o|u,0|_,a|_,o|c],o=8192,h=1<<23,a=o|h,_=1,c=128,u=_|c,p=[a|_,o|u,o|u,0|c,a|c,h|u,h|_,o|_,0,0|a,0|a,a|u,0|u,0,h|c,h|_,0|_,0|o,0|h,a|_,0|c,0|h,o|_,o|c,h|u,0|_,o|c,h|c,0|o,a|c,a|u,0|u,h|c,h|_,0|a,a|u,0|u,0,0,0|a,o|c,h|c,h|u,0|_,a|_,o|u,o|u,0|c,a|u,0|u,0|_,0|o,h|_,o|_,a|c,h|u,o|_,o|c,0|h,a|_,0|c,0|h,0|o,a|c],o=1<<25,h=1<<30,a=o|h,_=256,c=1<<19,u=_|c,g=[0|_,o|u,o|c,a|_,0|c,0|_,0|h,o|c,h|u,0|c,o|_,h|u,a|_,a|c,0|u,0|h,0|o,h|c,h|c,0,h|_,a|u,a|u,o|_,a|c,h|_,0,0|a,o|u,0|o,0|a,0|u,0|c,a|_,0|_,0|o,0|h,o|c,a|_,h|u,o|_,0|h,a|c,o|u,h|u,0|_,0|o,a|c,a|u,0|u,0|a,a|u,o|c,0,h|c,0|a,0|u,o|_,h|_,0|c,0,h|c,o|u,h|_],o=1<<22,h=1<<29,a=o|h,_=16,c=16384,u=_|c,b=[h|_,0|a,0|c,a|u,0|a,0|_,a|u,0|o,h|c,o|u,0|o,h|_,o|_,h|c,0|h,0|u,0,o|_,h|u,0|c,o|c,h|u,0|_,a|_,a|_,0,o|u,a|c,0|u,o|c,a|c,0|h,h|c,0|_,a|_,o|c,a|u,0|o,0|u,h|_,0|o,h|c,0|h,0|u,h|_,a|u,o|c,0|a,o|u,a|c,0,a|_,0|_,0|c,0|a,o|u,0|c,o|_,h|u,0,a|c,0|h,o|_,h|u],o=1<<21,h=1<<26,a=o|h,_=2,c=2048,u=_|c,v=[0|o,a|_,h|u,0,0|c,h|u,o|u,a|c,a|u,0|o,0,h|_,0|_,0|h,a|_,0|u,h|c,o|u,o|_,h|c,h|_,0|a,a|c,o|_,0|a,0|c,0|u,a|u,o|c,0|_,0|h,o|c,0|h,o|c,0|o,h|u,h|u,a|_,a|_,0|_,o|_,0|h,h|c,0|o,a|c,0|u,o|u,a|c,0|u,h|_,a|u,0|a,o|c,0,0|_,a|u,0,o|u,0|a,0|c,h|_,h|c,0|c,o|_],o=1<<18,h=1<<28,a=o|h,_=64,c=4096,u=_|c,y=[h|u,0|c,0|o,a|u,0|h,h|u,0|_,0|h,o|_,0|a,a|u,o|c,a|c,o|u,0|c,0|_,0|a,h|_,h|c,0|u,o|c,o|_,a|_,a|c,0|u,0,0,a|_,h|_,h|c,o|u,0|o,o|u,0|o,a|c,0|c,0|_,a|_,0|c,o|u,h|c,0|_,h|_,0|a,a|_,0|h,0|o,h|u,0,a|u,o|_,h|_,0|a,h|c,h|u,0,a|u,o|c,o|c,0|u,0|u,o|_,0|h,a|c],e.exports=function(t){return i(t),{encrypt:n}}},{}],8:[function(t,e,s){function i(t){if(r("new()"),this._drawCtx=null,this._c_forceCanvas=!1,this._renderQ=[],this._fb_width=0,this._fb_height=0,this._maxWidth=0,this._maxHeight=0,this._viewportLoc={x:0,y:0,w:0,h:0},this._cleanRect={x1:0,y1:0,x2:-1,y2:-1},this._prevDrawStyle="",this._tile=null,this._tile16x16=null,this._tile_x=0,this._tile_y=0,h.set_defaults(this,t,{true_color:!0,colourMap:[],scale:1,viewport:!1,render_mode:""}),!this._target)throw new Error("Target must be set");if("string"==typeof this._target)throw new Error("target must be a DOM element");if(!this._target.getContext)throw new Error("no getContext method");if(this._drawCtx||(this._drawCtx=this._target.getContext("2d")),this.clear(),!("createImageData"in this._drawCtx))throw new Error("Canvas does not support createImageData");this._render_mode="canvas rendering",null===this._prefer_js&&(this._prefer_js=!0),(this._cursor_uri||null===this._cursor_uri||void 0===this._cursor_uri)&&(this._cursor_uri=h.browserSupportsCursorURIs())}e.exports=i;var r=t("debug")("noVNC:Display"),n=t("debug")("noVNC:ERROR:Display");n.log=console.warn.bind(console);var o=t("bowser").browser,h=t("./util"),a=t("./base64");i.prototype={viewportChangePos:function(t,e){var s=this._viewportLoc;this._viewport||(t=-s.w,e=-s.h);var i=s.x+s.w-1,n=s.y+s.h-1;if(t<0&&s.x+t<0&&(t=-s.x),i+t>=this._fb_width&&(t-=i+t-this._fb_width+1),s.y+e<0&&(e=-s.y),n+e>=this._fb_height&&(e-=n+e-this._fb_height+1),0!==t||0!==e){r("viewportChangePos() | deltaX: "+t+", deltaY: "+e),s.x+=t,i+=t,s.y+=e,n+=e;var o=this._cleanRect;s.x>o.x1&&(o.x1=s.x),i<o.x2&&(o.x2=i),s.y>o.y1&&(o.y1=s.y),n<o.y2&&(o.y2=n);var h,a;t<0?(h=0,a=-t):(h=s.w-t,a=t);var _,c;e<0?(_=0,c=-e):(_=s.h-e,c=e);var u=this._drawCtx.fillStyle,l=this._target;this._drawCtx.fillStyle="rgb(255,255,255)",0!==t&&(this._drawCtx.drawImage(l,0,0,s.w,s.h,-t,0,s.w,s.h),this._drawCtx.fillRect(h,0,a,s.h)),0!==e&&(this._drawCtx.drawImage(l,0,0,s.w,s.h,0,-e,s.w,s.h),this._drawCtx.fillRect(0,_,s.w,c)),this._drawCtx.fillStyle=u}},viewportChangeSize:function(t,e){void 0!==t&&void 0!==e||(r("viewportChangeSize() | setting viewport to full display region"),t=this._fb_width,e=this._fb_height);var s=this._viewportLoc;if(s.w!==t||s.h!==e){this._viewport&&(0!==this._maxWidth&&t>this._maxWidth&&(t=this._maxWidth),0!==this._maxHeight&&e>this._maxHeight&&(e=this._maxHeight));var i=this._cleanRect;t<s.w&&i.x2>s.x+t-1&&(i.x2=s.x+t-1),e<s.h&&i.y2>s.y+e-1&&(i.y2=s.y+e-1),s.w=t,s.h=e;var n=this._target;if(n.width!==t||n.height!==e){var o=null;if(s.w>0&&s.h>0&&n.width>0&&n.height>0){var h=n.width<s.w?n.width:s.w,a=n.height<s.h?n.height:s.h;o=this._drawCtx.getImageData(0,0,h,a)}n.width!==t&&(n.width=t,n.style.width=t+"px"),n.height!==e&&(n.height=e,n.style.height=e+"px"),o&&this._drawCtx.putImageData(o,0,0)}}},getCleanDirtyReset:function(){var t=this._viewportLoc,e=this._cleanRect,s={x:e.x1,y:e.y1,w:e.x2-e.x1+1,h:e.y2-e.y1+1},i=[];if(e.x1>=e.x2||e.y1>=e.y2)i.push({x:t.x,y:t.y,w:t.w,h:t.h});else{var r=t.x+t.w-1,n=t.y+t.h-1;t.x<e.x1&&i.push({x:t.x,y:t.y,w:e.x1-t.x+1,h:t.h}),r>e.x2&&i.push({x:e.x2+1,y:t.y,w:r-e.x2,h:t.h}),t.y<e.y1&&i.push({x:e.x1,y:t.y,w:e.x2-e.x1+1,h:e.y1-t.y}),n>e.y2&&i.push({x:e.x1,y:e.y2+1,w:e.x2-e.x1+1,h:n-e.y2})}return this._cleanRect={x1:t.x,y1:t.y,x2:t.x+t.w-1,y2:t.y+t.h-1},{cleanBox:s,dirtyBoxes:i}},absX:function(t){return t+this._viewportLoc.x},absY:function(t){return t+this._viewportLoc.y},resize:function(t,e){this._prevDrawStyle="",this._fb_width=t,this._fb_height=e,this._rescale(this._scale),this.viewportChangeSize()},clear:function(){this._logo?(this.resize(this._logo.width,this._logo.height),this.blitStringImage(this._logo.data,0,0)):(o.msie&&10===parseInt(o.version)&&this._drawCtx.clearRect(0,0,this._viewportLoc.w,this._viewportLoc.h),this.resize(240,20),this._drawCtx.clearRect(0,0,this._viewportLoc.w,this._viewportLoc.h)),this._renderQ=[]},fillRect:function(t,e,s,i,r){this._setFillColor(r),this._drawCtx.fillRect(t-this._viewportLoc.x,e-this._viewportLoc.y,s,i)},copyImage:function(t,e,s,i,r,n){var o=t-this._viewportLoc.x,h=e-this._viewportLoc.y,a=s-this._viewportLoc.x,_=i-this._viewportLoc.y;this._drawCtx.drawImage(this._target,o,h,r,n,a,_,r,n)},startTile:function(t,e,s,i,r){if(this._tile_x=t,this._tile_y=e,this._tile=16===s&&16===i?this._tile16x16:this._drawCtx.createImageData(s,i),this._prefer_js){var n;n=this._true_color?r:this._colourMap[r[0]];for(var o=n[2],h=n[1],a=n[0],_=this._tile.data,c=0;c<s*i*4;c+=4)_[c]=o,_[c+1]=h,_[c+2]=a,_[c+3]=255}else this.fillRect(t,e,s,i,r)},subTile:function(t,e,s,i,r){if(this._prefer_js){var n;n=this._true_color?r:this._colourMap[r[0]];for(var o=n[2],h=n[1],a=n[0],_=t+s,c=e+i,u=this._tile.data,l=this._tile.width,d=e;d<c;d++)for(var f=t;f<_;f++){var p=4*(f+d*l);u[p]=o,u[p+1]=h,u[p+2]=a,u[p+3]=255}}else this.fillRect(this._tile_x+t,this._tile_y+e,s,i,r)},finishTile:function(){this._prefer_js&&this._drawCtx.putImageData(this._tile,this._tile_x-this._viewportLoc.x,this._tile_y-this._viewportLoc.y)},blitImage:function(t,e,s,i,r,n){this._true_color?this._bgrxImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,s,i,r,n):this._cmapImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,s,i,r,n)},blitRgbImage:function(t,e,s,i,r,n){this._true_color?this._rgbImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,s,i,r,n):this._cmapImageData(t,e,this._viewportLoc.x,this._viewportLoc.y,s,i,r,n)},blitStringImage:function(t,e,s){var i=new Image;return i.onload=function(){this._drawCtx.drawImage(i,e-this._viewportLoc.x,s-this._viewportLoc.y)}.bind(this),i.src=t,i},drawImage:function(t,e,s){this._drawCtx.drawImage(t,e-this._viewportLoc.x,s-this._viewportLoc.y)},renderQ_push:function(t){this._renderQ.push(t),1===this._renderQ.length&&this._scan_renderQ()},changeCursor:function(t,e,s,r,o,h){if(!1===this._cursor_uri)return void n("changeCursor() | called but no cursor data URI support");this._true_color?i.changeCursor(this._target,t,e,s,r,o,h):i.changeCursor(this._target,t,e,s,r,o,h,this._colourMap)},defaultCursor:function(){this._target.style.cursor="default"},disableLocalCursor:function(){this._target.style.cursor="none"},clippingDisplay:function(){var t=this._viewportLoc,e=this._fb_width>t.w||this._fb_height>t.h,s=0!==this._maxWidth&&0!==this._maxHeight,i=!1;return s&&(i=t.w>this._maxWidth||t.h>this._maxHeight),e||s&&i},get_context:function(){return this._drawCtx},set_scale:function(t){this._rescale(t)},set_width:function(t){this._fb_width=t},get_width:function(){return this._fb_width},set_height:function(t){this._fb_height=t},get_height:function(){return this._fb_height},autoscale:function(t,e,s){var i,r=t/e,n=this._fb_width/this._fb_height;i=n>=r?t/this._fb_width:e/this._fb_height;var o,h;return i>1&&s?(o=this._fb_width,h=this._fb_height,i=1):n>=r?(o=t,h=Math.round(t/n)):(o=Math.round(e*n),h=e),this._target.style.width=o+"px",this._target.style.height=h+"px",this._scale=i,i},_rescale:function(t){this._scale=t;var e,s;this._viewport&&0!==this._maxWidth&&0!==this._maxHeight?(e=Math.min(this._fb_width,this._maxWidth),s=Math.min(this._fb_height,this._maxHeight)):(e=this._fb_width,s=this._fb_height),this._target.style.width=Math.round(t*e)+"px",this._target.style.height=Math.round(t*s)+"px"},_setFillColor:function(t){var e;e=this._true_color?t:this._colourMap[t[0]];var s="rgb("+e[2]+","+e[1]+","+e[0]+")";s!==this._prevDrawStyle&&(this._drawCtx.fillStyle=s,this._prevDrawStyle=s)},_rgbImageData:function(t,e,s,i,r,n,o,h){for(var a=this._drawCtx.createImageData(r,n),_=a.data,c=0,u=h;c<r*n*4;c+=4,u+=3)_[c]=o[u],_[c+1]=o[u+1],_[c+2]=o[u+2],_[c+3]=255;this._drawCtx.putImageData(a,t-s,e-i)},_bgrxImageData:function(t,e,s,i,r,n,o,h){for(var a=this._drawCtx.createImageData(r,n),_=a.data,c=0,u=h;c<r*n*4;c+=4,u+=4)_[c]=o[u+2],_[c+1]=o[u+1],_[c+2]=o[u],_[c+3]=255;this._drawCtx.putImageData(a,t-s,e-i)},_cmapImageData:function(t,e,s,i,r,n,o,h){for(var a=this._drawCtx.createImageData(r,n),_=a.data,c=this._colourMap,u=0,l=h;u<r*n*4;u+=4,l++){var d=c[o[l]];_[u]=d[2],_[u+1]=d[1],_[u+2]=d[0],_[u+3]=255}this._drawCtx.putImageData(a,t-s,e-i)},_scan_renderQ:function(){for(var t=!0;t&&this._renderQ.length>0;){var e=this._renderQ[0];switch(e.type){case"copy":this.copyImage(e.old_x,e.old_y,e.x,e.y,e.width,e.height);break;case"fill":this.fillRect(e.x,e.y,e.width,e.height,e.color);break;case"blit":this.blitImage(e.x,e.y,e.width,e.height,e.data,0);break;case"blitRgb":this.blitRgbImage(e.x,e.y,e.width,e.height,e.data,0);break;case"img":e.img.complete?this.drawImage(e.img,e.x,e.y):t=!1}t&&this._renderQ.shift()}this._renderQ.length>0&&h.requestAnimationFrame(this._scan_renderQ.bind(this))}},h.make_properties(i,[["target","wo","dom"],["context","ro","raw"],["logo","rw","raw"],["true_color","rw","bool"],["colourMap","rw","arr"],["scale","rw","float"],["viewport","rw","bool"],["width","rw","int"],["height","rw","int"],["maxWidth","rw","int"],["maxHeight","rw","int"],["render_mode","ro","str"],["prefer_js","rw","str"],["cursor_uri","rw","raw"]]),i.changeCursor=function(t,e,s,i,r,n,o,h){var _=n,c=o;c<_?c=_:_=c;var u=[];u.push16le=function(t){this.push(255&t,t>>8&255)},u.push32le=function(t){this.push(255&t,t>>8&255,t>>16&255,t>>24&255)};var l=_*c*4,d=Math.ceil(_*c/8),f=Math.ceil(_*c/8);u.push16le(0),u.push16le(2),u.push16le(1),u.push(_),u.push(c),u.push(0),u.push(0),u.push16le(i),u.push16le(r),u.push32le(40+l+d+f),u.push32le(22),u.push32le(40),u.push32le(_),u.push32le(2*c),u.push16le(1),u.push16le(32),u.push32le(0),u.push32le(d+f),u.push32le(0),u.push32le(0),u.push32le(0),u.push32le(0);var p,g;for(p=c-1;p>=0;p--)for(g=0;g<_;g++)if(g>=n||p>=o)u.push(0),u.push(0),u.push(0),u.push(0);else{var b=p*Math.ceil(n/8)+Math.floor(g/8),v=s[b]<<g%8&128?255:0;if(h){b=n*p+g;var y=h[e[b]];u.push(y[2]),u.push(y[1]),u.push(y[0]),u.push(v)}else b=4*(n*p+g),u.push(e[b+2]),u.push(e[b+1]),u.push(e[b]),u.push(v)}for(p=0;p<c;p++)for(g=0;g<Math.ceil(_/8);g++)u.push(0);for(p=0;p<c;p++)for(g=0;g<Math.ceil(_/8);g++)u.push(0);var m="data:image/x-icon;base64,"+a.encode(u);t.style.cursor="url("+m+")"+i+" "+r+", default"}},{"./base64":6,"./util":14,bowser:1,debug:2}],9:[function(t,e,s){(function(s){function i(t){this._keyDownList=[],_.set_defaults(this,t,{target:document,focused:!0}),this._handler=new c.KeyEventDecoder(c.ModifierSync(),c.VerifyCharModifier(c.TrackKeyState(c.EscapeModifiers(this._handleRfbEvent.bind(this))))),this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),keypress:this._handleKeyPress.bind(this),blur:this._allKeysUp.bind(this)}}function r(t){this._mouseCaptured=!1,this._doubleClickTimer=null,this._lastTouchPos=null,_.set_defaults(this,t,{target:document,focused:!0,scale:1,zoom:1,touchButton:1}),this._eventHandlers={mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this)}}var n=e.exports={},o=t("debug")("noVNC:Input:Keybord"),h=t("debug")("noVNC:Input:Mouse"),a=t("bowser").browser,_=t("./util"),c=t("./kbdutil");i.prototype={_handleRfbEvent:function(t){this._onKeyPress&&(o("onKeyPress: "+("keydown"===t.type?"down":"up")+", keysym: "+t.keysym.keysym+"("+t.keysym.keyname+")"),this._onKeyPress(t.keysym.keysym,"keydown"===t.type))},_handleKeyDown:function(t){return!this._focused||(!this._handler.keydown(t)||(_.stopEvent(t),!1))},_handleKeyPress:function(t){return!this._focused||(!this._handler.keypress(t)||(_.stopEvent(t),!1))},_handleKeyUp:function(t){return!this._focused||(!this._handler.keyup(t)||(_.stopEvent(t),!1))},_allKeysUp:function(){o("allKeysUp"),this._handler.releaseAll()},grab:function(){o("grab()");var t=this._target;_.addEvent(t,"keydown",this._eventHandlers.keydown),_.addEvent(t,"keyup",this._eventHandlers.keyup),_.addEvent(t,"keypress",this._eventHandlers.keypress),_.addEvent(s,"blur",this._eventHandlers.blur)},ungrab:function(){o("ungrab()");var t=this._target;_.removeEvent(t,"keydown",this._eventHandlers.keydown),_.removeEvent(t,"keyup",this._eventHandlers.keyup),_.removeEvent(t,"keypress",this._eventHandlers.keypress),_.removeEvent(s,"blur",this._eventHandlers.blur),this._allKeysUp()},sync:function(t){this._handler.syncModifiers(t)}},_.make_properties(i,[["target","wo","dom"],["focused","rw","bool"],["onKeyPress","rw","func"]]),r.prototype={_captureMouse:function(){this._target.setCapture&&this._target.setCapture(),this._mouseCaptured=!0},_releaseMouse:function(){this._target.releaseCapture&&this._target.releaseCapture(),this._mouseCaptured=!1},_resetDoubleClickTimer:function(){this._doubleClickTimer=null},_handleMouseButton:function(t,e){if(!this._focused)return!0;this._notify&&this._notify(t);var i,r=t||s.event,n=_.getEventPosition(t,this._target,this._scale,this._zoom);if(t.touches||t.changedTouches){if(1===e){if(null===this._doubleClickTimer)this._lastTouchPos=n;else{clearTimeout(this._doubleClickTimer);var o=this._lastTouchPos.x-n.x,a=this._lastTouchPos.y-n.y;Math.sqrt(o*o+a*a)<20*s.devicePixelRatio&&(n=this._lastTouchPos)}this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)}i=this._touchButton}else i=r.which?1<<r.button:(1&r.button)+2*(2&r.button)+(4&r.button)/2;return this._onMouseButton&&(h("onMouseButton: "+(e?"down":"up")+", x: "+n.x+", y: "+n.y+", bmask: "+i),this._onMouseButton(n.x,n.y,e,i)),_.stopEvent(t),!1},_handleMouseDown:function(t){this._captureMouse(),this._handleMouseButton(t,1)},_handleMouseUp:function(t){this._mouseCaptured&&(this._handleMouseButton(t,0),this._releaseMouse())},_handleMouseWheel:function(t){if(!this._focused)return!0;this._notify&&this._notify(t);var e,i=t||s.event,r=_.getEventPosition(t,this._target,this._scale,this._zoom),n=i.detail?-1*i.detail:i.wheelDelta/40;return e=n>0?8:16,this._onMouseButton&&(this._onMouseButton(r.x,r.y,1,e),this._onMouseButton(r.x,r.y,0,e)),_.stopEvent(t),!1},_handleMouseMove:function(t){if(!this._focused)return!0;this._notify&&this._notify(t);var e=_.getEventPosition(t,this._target,this._scale,this._zoom);return this._onMouseMove&&this._onMouseMove(e.x,e.y),_.stopEvent(t),!1},_handleMouseDisable:function(t){if(!this._focused)return!0;var e=_.getEventPosition(t,this._target,this._scale,this._zoom);return!(e.realx>=0&&e.realy>=0&&e.realx<this._target.offsetWidth&&e.realy<this._target.offsetHeight)||(_.stopEvent(t),!1)},grab:function(){h("grab()");var t=this._target,e="ontouchstart"in document.documentElement;e&&(_.addEvent(t,"touchstart",this._eventHandlers.mousedown),_.addEvent(s,"touchend",this._eventHandlers.mouseup),_.addEvent(t,"touchend",this._eventHandlers.mouseup),_.addEvent(t,"touchmove",this._eventHandlers.mousemove)),e&&!this._enableMouseAndTouch||(_.addEvent(t,"mousedown",this._eventHandlers.mousedown),_.addEvent(s,"mouseup",this._eventHandlers.mouseup),_.addEvent(t,"mouseup",this._eventHandlers.mouseup),_.addEvent(t,"mousemove",this._eventHandlers.mousemove),_.addEvent(t,a.gecko?"DOMMouseScroll":"mousewheel",this._eventHandlers.mousewheel)),_.addEvent(document,"click",this._eventHandlers.mousedisable),_.addEvent(document.body,"contextmenu",this._eventHandlers.mousedisable)},ungrab:function(){h("ungrab()");var t=this._target,e="ontouchstart"in document.documentElement;e&&(_.removeEvent(t,"touchstart",this._eventHandlers.mousedown),_.removeEvent(s,"touchend",this._eventHandlers.mouseup),_.removeEvent(t,"touchend",this._eventHandlers.mouseup),_.removeEvent(t,"touchmove",this._eventHandlers.mousemove)),e&&!this._enableMouseAndTouch||(_.removeEvent(t,"mousedown",this._eventHandlers.mousedown),_.removeEvent(s,"mouseup",this._eventHandlers.mouseup),_.removeEvent(t,"mouseup",this._eventHandlers.mouseup),_.removeEvent(t,"mousemove",this._eventHandlers.mousemove),_.removeEvent(t,a.gecko?"DOMMouseScroll":"mousewheel",this._eventHandlers.mousewheel)),_.removeEvent(document,"click",this._eventHandlers.mousedisable),_.removeEvent(document.body,"contextmenu",this._eventHandlers.mousedisable)}},_.make_properties(r,[["target","ro","dom"],["notify","ro","func"],["focused","rw","bool"],["scale","rw","float"],["zoom","rw","float"],["enableMouseAndTouch","rw","bool"],["onMouseButton","rw","func"],["onMouseMove","rw","func"],["touchButton","rw","int"]]),n.Keyboard=i,n.Mouse=r}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./kbdutil":10,"./util":14,bowser:1,debug:2}],10:[function(t,e,s){function i(){return navigator&&!!/mac/i.exec(navigator.platform)}function r(){return navigator&&!!/win/i.exec(navigator.platform)}function n(){return navigator&&!!/linux/i.exec(navigator.platform)}var o=t("debug")("noVNC:ERROR:KbdUtil");o.log=console.warn.bind(console);var h=t("./keys"),a=e.exports={hasShortcutModifier:function(t,e){var s={};for(var i in e)parseInt(i)!==h.XK_Shift_L&&(s[i]=e[i]);var r=0;for(var n in e)s[n]&&++r;return a.hasCharModifier(t,s)?r>t.length:r>0},hasCharModifier:function(t,e){if(0===t.length)return!1;for(var s=0;s<t.length;++s)if(!e[t[s]])return!1;return!0},ModifierSync:function(t){function e(t,e){function s(t){return{keysym:h.lookup(t),type:o[t]?"keydown":"keyup"}}var i=[];return void 0!==t.ctrlKey&&t.ctrlKey!==o[h.XK_Control_L]&&e!==h.XK_Control_L&&(o[h.XK_Control_L]=t.ctrlKey,i.push(s(h.XK_Control_L))),void 0!==t.altKey&&t.altKey!==o[h.XK_Alt_L]&&e!==h.XK_Alt_L&&(o[h.XK_Alt_L]=t.altKey,i.push(s(h.XK_Alt_L))),void 0!==t.altGraphKey&&t.altGraphKey!==o[h.XK_ISO_Level3_Shift]&&e!==h.XK_ISO_Level3_Shift&&(o[h.XK_ISO_Level3_Shift]=t.altGraphKey,i.push(s(h.XK_ISO_Level3_Shift))),void 0!==t.shiftKey&&t.shiftKey!==o[h.XK_Shift_L]&&e!==h.XK_Shift_L&&(o[h.XK_Shift_L]=t.shiftKey,
i.push(s(h.XK_Shift_L))),void 0!==t.metaKey&&t.metaKey!==o[h.XK_Meta_L]&&e!==h.XK_Meta_L&&(o[h.XK_Meta_L]=t.metaKey,i.push(s(h.XK_Meta_L))),i}function s(t,s){var i=a.getKeysym(t),r=i?i.keysym:null;return null!==r&&void 0!==o[r]&&(o[r]=s),e(t,r)}t||(t=i()?[h.XK_Alt_L]:r()?[h.XK_Alt_L,h.XK_Control_L]:n()?[h.XK_ISO_Level3_Shift]:[]);var o={};return o[h.XK_Control_L]=!1,o[h.XK_Alt_L]=!1,o[h.XK_ISO_Level3_Shift]=!1,o[h.XK_Shift_L]=!1,o[h.XK_Meta_L]=!1,{keydown:function(t){return s(t,!0)},keyup:function(t){return s(t,!1)},syncAny:function(t){return e(t)},hasShortcutModifier:function(){return a.hasShortcutModifier(t,o)},activeCharModifier:function(){return a.hasCharModifier(t,o)?t:null}}},getKey:function(t){return"keyCode"in t&&"key"in t?t.key+":"+t.keyCode:"keyCode"in t?t.keyCode:t.key},getKeysym:function(t){var e;if(t.char&&1===t.char.length?e=t.char.charCodeAt():t.charCode?e=t.charCode:t.keyCode&&"keypress"===t.type&&(e=t.keyCode),e){var s=h.fromUnicode(a.substituteCodepoint(e));if(s)return s}return t.keyCode?h.lookup(a.keysymFromKeyCode(t.keyCode,t.shiftKey)):t.which?h.lookup(a.keysymFromKeyCode(t.which,t.shiftKey)):null},keysymFromKeyCode:function(t,e){if("number"!=typeof t)return null;if(t>=48&&t<=57)return t;if(t>=65&&t<=90)return e?t:t+32;if(t>=96&&t<=105)return h.XK_KP_0+(t-96);switch(t){case 32:return h.XK_space;case 106:return h.XK_KP_Multiply;case 107:return h.XK_KP_Add;case 108:return h.XK_KP_Separator;case 109:return h.XK_KP_Subtract;case 110:return h.XK_KP_Decimal;case 111:return h.XK_KP_Divide;case 187:return h.XK_plus;case 188:return h.XK_comma;case 189:return h.XK_minus;case 190:return h.XK_period}return a.nonCharacterKey({keyCode:t})},nonCharacterKey:function(t){if(!t.keyCode)return null;var e=t.keyCode;if(e>=112&&e<=135)return h.XK_F1+e-112;switch(e){case 8:return h.XK_BackSpace;case 13:return h.XK_Return;case 9:return h.XK_Tab;case 27:return h.XK_Escape;case 46:return h.XK_Delete;case 36:return h.XK_Home;case 35:return h.XK_End;case 33:return h.XK_Page_Up;case 34:return h.XK_Page_Down;case 45:return h.XK_Insert;case 37:return h.XK_Left;case 38:return h.XK_Up;case 39:return h.XK_Right;case 40:return h.XK_Down;case 16:return h.XK_Shift_L;case 17:return h.XK_Control_L;case 18:return h.XK_Alt_L;case 224:return h.XK_Meta_L;case 225:return h.XK_ISO_Level3_Shift;case 91:return h.XK_Super_L;case 92:return h.XK_Super_R;case 93:return h.XK_Menu;default:return null}},substituteCodepoint:function(t){var e={536:350,537:351,538:354,539:355},s=e[t];return s||t},KeyEventDecoder:function(t,e){function s(t){for(var s=0;s<t.length;++s)e(t[s])}function i(s,i){var r={type:i},n=a.getKey(s);n&&(r.keyId=n);var o=a.getKeysym(s),h=t.hasShortcutModifier()||!!t.activeCharModifier();o&&("keydown"!==i||a.nonCharacterKey(s)||h)&&(r.keysym=o);var _=16===s.keyCode||"Shift"===s.key,c=!_&&("keydown"!==i||t.hasShortcutModifier()||!!a.nonCharacterKey(s)),u="keydown"===i&&t.activeCharModifier()&&!a.nonCharacterKey(s),l=t.activeCharModifier();if(l&&o){for(var d=!1,f=0;f<l.length;++f)l[f]===o.keysym&&(d=!0);"keypress"!==i||d||(r.escape=t.activeCharModifier())}return u&&e({type:"stall"}),e(r),c}return{keydown:function(e){return s(t.keydown(e)),i(e,"keydown")},keypress:function(t){return i(t,"keypress")},keyup:function(e){return s(t.keyup(e)),i(e,"keyup")},syncModifiers:function(e){s(t.syncAny(e))},releaseAll:function(){e({type:"releaseall"})}}},VerifyCharModifier:function(t){function e(){function r(){clearTimeout(i),i=null,e()}if(!i)for(;0!==s.length;){var n=s[0];switch(s=s.splice(1),n.type){case"stall":return void(i=setTimeout(r,5));case"keydown":0!==s.length&&"keypress"===s[0].type&&(!s[0].escape||n.keysym&&n.keysym.keysym===s[0].keysym.keysym||(n.escape=s[0].escape),n.keysym=s[0].keysym,s=s.splice(1))}"stall"!==n.type&&t(n)}}var s=[],i=null;return function(t){s.push(t),e()}},TrackKeyState:function(t){var e=[];return function(s){var i=0!==e.length?e[e.length-1]:null;switch(s.type){case"keydown":i&&s.keyId&&i.keyId===s.keyId||(i={keyId:s.keyId,keysyms:{}},e.push(i)),s.keysym&&(i.keysyms[s.keysym.keysym]=s.keysym,i.ignoreKeyPress=!0,t(s));break;case"keypress":i||(i={keyId:s.keyId,keysyms:{}},e.push(i)),s.keysym||o("TrackKeyState() | keypress with no keysym:",s),s.keysym&&!i.ignoreKeyPress&&(i.keysyms[s.keysym.keysym]=s.keysym,s.type="keydown",t(s));break;case"keyup":if(0===e.length)return;for(var r=null,n=0;n!==e.length;++n)if(e[n].keyId===s.keyId){r=n;break}null===r&&(r=e.length-1);var h=e.splice(r,1)[0],a=function(){function t(){}return function(e){return t.prototype=e,new t}}();for(var _ in h.keysyms){var c=a(s);c.keysym=h.keysyms[_],t(c)}break;case"releaseall":for(var n=0;n<e.length;++n)for(var _ in e[n].keysyms){var u=e[n].keysyms[_];t({keyId:0,keysym:u,type:"keyup"})}e=[]}}},EscapeModifiers:function(t){return function(e){var s;if("keydown"!==e.type||void 0===e.escape)return void t(e);for(s=0;s<e.escape.length;++s)t({type:"keyup",keyId:0,keysym:h.lookup(e.escape[s])});for(t(e),s=0;s<e.escape.length;++s)t({type:"keydown",keyId:0,keysym:h.lookup(e.escape[s])})}}}},{"./keys":11,debug:2}],11:[function(t,e,s){function i(t){return t?{keysym:t,keyname:o?o[t]:t}:void 0}function r(t){return i(h[t])}var n={XK_VoidSymbol:16777215,XK_BackSpace:65288,XK_Tab:65289,XK_Linefeed:65290,XK_Clear:65291,XK_Return:65293,XK_Pause:65299,XK_Scroll_Lock:65300,XK_Sys_Req:65301,XK_Escape:65307,XK_Delete:65535,XK_Home:65360,XK_Left:65361,XK_Up:65362,XK_Right:65363,XK_Down:65364,XK_Prior:65365,XK_Page_Up:65365,XK_Next:65366,XK_Page_Down:65366,XK_End:65367,XK_Begin:65368,XK_Select:65376,XK_Print:65377,XK_Execute:65378,XK_Insert:65379,XK_Undo:65381,XK_Redo:65382,XK_Menu:65383,XK_Find:65384,XK_Cancel:65385,XK_Help:65386,XK_Break:65387,XK_Mode_switch:65406,XK_script_switch:65406,XK_Num_Lock:65407,XK_KP_Space:65408,XK_KP_Tab:65417,XK_KP_Enter:65421,XK_KP_F1:65425,XK_KP_F2:65426,XK_KP_F3:65427,XK_KP_F4:65428,XK_KP_Home:65429,XK_KP_Left:65430,XK_KP_Up:65431,XK_KP_Right:65432,XK_KP_Down:65433,XK_KP_Prior:65434,XK_KP_Page_Up:65434,XK_KP_Next:65435,XK_KP_Page_Down:65435,XK_KP_End:65436,XK_KP_Begin:65437,XK_KP_Insert:65438,XK_KP_Delete:65439,XK_KP_Equal:65469,XK_KP_Multiply:65450,XK_KP_Add:65451,XK_KP_Separator:65452,XK_KP_Subtract:65453,XK_KP_Decimal:65454,XK_KP_Divide:65455,XK_KP_0:65456,XK_KP_1:65457,XK_KP_2:65458,XK_KP_3:65459,XK_KP_4:65460,XK_KP_5:65461,XK_KP_6:65462,XK_KP_7:65463,XK_KP_8:65464,XK_KP_9:65465,XK_F1:65470,XK_F2:65471,XK_F3:65472,XK_F4:65473,XK_F5:65474,XK_F6:65475,XK_F7:65476,XK_F8:65477,XK_F9:65478,XK_F10:65479,XK_F11:65480,XK_L1:65480,XK_F12:65481,XK_L2:65481,XK_F13:65482,XK_L3:65482,XK_F14:65483,XK_L4:65483,XK_F15:65484,XK_L5:65484,XK_F16:65485,XK_L6:65485,XK_F17:65486,XK_L7:65486,XK_F18:65487,XK_L8:65487,XK_F19:65488,XK_L9:65488,XK_F20:65489,XK_L10:65489,XK_F21:65490,XK_R1:65490,XK_F22:65491,XK_R2:65491,XK_F23:65492,XK_R3:65492,XK_F24:65493,XK_R4:65493,XK_F25:65494,XK_R5:65494,XK_F26:65495,XK_R6:65495,XK_F27:65496,XK_R7:65496,XK_F28:65497,XK_R8:65497,XK_F29:65498,XK_R9:65498,XK_F30:65499,XK_R10:65499,XK_F31:65500,XK_R11:65500,XK_F32:65501,XK_R12:65501,XK_F33:65502,XK_R13:65502,XK_F34:65503,XK_R14:65503,XK_F35:65504,XK_R15:65504,XK_Shift_L:65505,XK_Shift_R:65506,XK_Control_L:65507,XK_Control_R:65508,XK_Caps_Lock:65509,XK_Shift_Lock:65510,XK_Meta_L:65511,XK_Meta_R:65512,XK_Alt_L:65513,XK_Alt_R:65514,XK_Super_L:65515,XK_Super_R:65516,XK_Hyper_L:65517,XK_Hyper_R:65518,XK_ISO_Level3_Shift:65027,XK_space:32,XK_exclam:33,XK_quotedbl:34,XK_numbersign:35,XK_dollar:36,XK_percent:37,XK_ampersand:38,XK_apostrophe:39,XK_quoteright:39,XK_parenleft:40,XK_parenright:41,XK_asterisk:42,XK_plus:43,XK_comma:44,XK_minus:45,XK_period:46,XK_slash:47,XK_0:48,XK_1:49,XK_2:50,XK_3:51,XK_4:52,XK_5:53,XK_6:54,XK_7:55,XK_8:56,XK_9:57,XK_colon:58,XK_semicolon:59,XK_less:60,XK_equal:61,XK_greater:62,XK_question:63,XK_at:64,XK_A:65,XK_B:66,XK_C:67,XK_D:68,XK_E:69,XK_F:70,XK_G:71,XK_H:72,XK_I:73,XK_J:74,XK_K:75,XK_L:76,XK_M:77,XK_N:78,XK_O:79,XK_P:80,XK_Q:81,XK_R:82,XK_S:83,XK_T:84,XK_U:85,XK_V:86,XK_W:87,XK_X:88,XK_Y:89,XK_Z:90,XK_bracketleft:91,XK_backslash:92,XK_bracketright:93,XK_asciicircum:94,XK_underscore:95,XK_grave:96,XK_quoteleft:96,XK_a:97,XK_b:98,XK_c:99,XK_d:100,XK_e:101,XK_f:102,XK_g:103,XK_h:104,XK_i:105,XK_j:106,XK_k:107,XK_l:108,XK_m:109,XK_n:110,XK_o:111,XK_p:112,XK_q:113,XK_r:114,XK_s:115,XK_t:116,XK_u:117,XK_v:118,XK_w:119,XK_x:120,XK_y:121,XK_z:122,XK_braceleft:123,XK_bar:124,XK_braceright:125,XK_asciitilde:126,XK_nobreakspace:160,XK_exclamdown:161,XK_cent:162,XK_sterling:163,XK_currency:164,XK_yen:165,XK_brokenbar:166,XK_section:167,XK_diaeresis:168,XK_copyright:169,XK_ordfeminine:170,XK_guillemotleft:171,XK_notsign:172,XK_hyphen:173,XK_registered:174,XK_macron:175,XK_degree:176,XK_plusminus:177,XK_twosuperior:178,XK_threesuperior:179,XK_acute:180,XK_mu:181,XK_paragraph:182,XK_periodcentered:183,XK_cedilla:184,XK_onesuperior:185,XK_masculine:186,XK_guillemotright:187,XK_onequarter:188,XK_onehalf:189,XK_threequarters:190,XK_questiondown:191,XK_Agrave:192,XK_Aacute:193,XK_Acircumflex:194,XK_Atilde:195,XK_Adiaeresis:196,XK_Aring:197,XK_AE:198,XK_Ccedilla:199,XK_Egrave:200,XK_Eacute:201,XK_Ecircumflex:202,XK_Ediaeresis:203,XK_Igrave:204,XK_Iacute:205,XK_Icircumflex:206,XK_Idiaeresis:207,XK_ETH:208,XK_Eth:208,XK_Ntilde:209,XK_Ograve:210,XK_Oacute:211,XK_Ocircumflex:212,XK_Otilde:213,XK_Odiaeresis:214,XK_multiply:215,XK_Oslash:216,XK_Ooblique:216,XK_Ugrave:217,XK_Uacute:218,XK_Ucircumflex:219,XK_Udiaeresis:220,XK_Yacute:221,XK_THORN:222,XK_Thorn:222,XK_ssharp:223,XK_agrave:224,XK_aacute:225,XK_acircumflex:226,XK_atilde:227,XK_adiaeresis:228,XK_aring:229,XK_ae:230,XK_ccedilla:231,XK_egrave:232,XK_eacute:233,XK_ecircumflex:234,XK_ediaeresis:235,XK_igrave:236,XK_iacute:237,XK_icircumflex:238,XK_idiaeresis:239,XK_eth:240,XK_ntilde:241,XK_ograve:242,XK_oacute:243,XK_ocircumflex:244,XK_otilde:245,XK_odiaeresis:246,XK_division:247,XK_oslash:248,XK_ooblique:248,XK_ugrave:249,XK_uacute:250,XK_ucircumflex:251,XK_udiaeresis:252,XK_yacute:253,XK_thorn:254,XK_ydiaeresis:255},o=null,h={32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:960,257:992,258:451,259:483,260:417,261:433,262:454,263:486,264:710,265:742,266:709,267:741,268:456,269:488,270:463,271:495,272:464,273:496,274:938,275:954,278:972,279:1004,280:458,281:490,282:460,283:492,284:728,285:760,286:683,287:699,288:725,289:757,290:939,291:955,292:678,293:694,294:673,295:689,296:933,297:949,298:975,299:1007,300:16777516,301:16777517,302:967,303:999,304:681,305:697,308:684,309:700,310:979,311:1011,312:930,313:453,314:485,315:934,316:950,317:421,318:437,321:419,322:435,323:465,324:497,325:977,326:1009,327:466,328:498,330:957,331:959,332:978,333:1010,336:469,337:501,338:5052,339:5053,340:448,341:480,342:931,343:947,344:472,345:504,346:422,347:438,348:734,349:766,350:426,351:442,352:425,353:441,354:478,355:510,356:427,357:443,358:940,359:956,360:989,361:1021,362:990,363:1022,364:733,365:765,366:473,367:505,368:475,369:507,370:985,371:1017,372:16777588,373:16777589,374:16777590,375:16777591,376:5054,377:428,378:444,379:431,380:447,381:430,382:446,399:16777615,402:2294,415:16777631,416:16777632,417:16777633,431:16777647,432:16777648,437:16777653,438:16777654,439:16777655,466:16777681,486:16777702,487:16777703,601:16777817,629:16777845,658:16777874,711:439,728:418,729:511,731:434,733:445,901:1966,902:1953,904:1954,905:1955,906:1956,908:1959,910:1960,911:1963,912:1974,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,938:1957,939:1961,940:1969,941:1970,942:1971,943:1972,944:1978,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,962:2035,963:2034,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,970:1973,971:1977,972:1975,973:1976,974:1979,1025:1715,1026:1713,1027:1714,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1038:1726,1039:1727,1040:1761,1041:1762,1042:1783,1043:1767,1044:1764,1045:1765,1046:1782,1047:1786,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1056:1778,1057:1779,1058:1780,1059:1781,1060:1766,1061:1768,1062:1763,1063:1790,1064:1787,1065:1789,1066:1791,1067:1785,1068:1784,1069:1788,1070:1760,1071:1777,1072:1729,1073:1730,1074:1751,1075:1735,1076:1732,1077:1733,1078:1750,1079:1754,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1088:1746,1089:1747,1090:1748,1091:1749,1092:1734,1093:1736,1094:1731,1095:1758,1096:1755,1097:1757,1098:1759,1099:1753,1100:1752,1101:1756,1102:1728,1103:1745,1105:1699,1106:1697,1107:1698,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1118:1710,1119:1711,1168:1725,1169:1709,1170:16778386,1171:16778387,1174:16778390,1175:16778391,1178:16778394,1179:16778395,1180:16778396,1181:16778397,1186:16778402,1187:16778403,1198:16778414,1199:16778415,1200:16778416,1201:16778417,1202:16778418,1203:16778419,1206:16778422,1207:16778423,1208:16778424,1209:16778425,1210:16778426,1211:16778427,1240:16778456,1241:16778457,1250:16778466,1251:16778467,1256:16778472,1257:16778473,1262:16778478,1263:16778479,1329:16778545,1330:16778546,1331:16778547,1332:16778548,1333:16778549,1334:16778550,1335:16778551,1336:16778552,1337:16778553,1338:16778554,1339:16778555,1340:16778556,1341:16778557,1342:16778558,1343:16778559,1344:16778560,1345:16778561,1346:16778562,1347:16778563,1348:16778564,1349:16778565,1350:16778566,1351:16778567,1352:16778568,1353:16778569,1354:16778570,1355:16778571,1356:16778572,1357:16778573,1358:16778574,1359:16778575,1360:16778576,1361:16778577,1362:16778578,1363:16778579,1364:16778580,1365:16778581,1366:16778582,1370:16778586,1371:16778587,1372:16778588,1373:16778589,1374:16778590,1377:16778593,1378:16778594,1379:16778595,1380:16778596,1381:16778597,1382:16778598,1383:16778599,1384:16778600,1385:16778601,1386:16778602,1387:16778603,1388:16778604,1389:16778605,1390:16778606,1391:16778607,1392:16778608,1393:16778609,1394:16778610,1395:16778611,1396:16778612,1397:16778613,1398:16778614,1399:16778615,1400:16778616,1401:16778617,1402:16778618,1403:16778619,1404:16778620,1405:16778621,1406:16778622,1407:16778623,1408:16778624,1409:16778625,1410:16778626,1411:16778627,1412:16778628,1413:16778629,1414:16778630,1415:16778631,1417:16778633,1418:16778634,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,1548:1452,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1619:16778835,1620:16778836,1621:16778837,1632:16778848,1633:16778849,1634:16778850,1635:16778851,1636:16778852,1637:16778853,1638:16778854,1639:16778855,1640:16778856,1641:16778857,1642:16778858,1648:16778864,1657:16778873,1662:16778878,1670:16778886,1672:16778888,1681:16778897,1688:16778904,1700:16778916,1705:16778921,1711:16778927,1722:16778938,1726:16778942,1729:16778945,1740:16778956,1746:16778962,1748:16778964,1776:16778992,1777:16778993,1778:16778994,1779:16778995,1780:16778996,1781:16778997,1782:16778998,1783:16778999,1784:16779e3,1785:16779001,3458:16780674,3459:16780675,3461:16780677,3462:16780678,3463:16780679,3464:16780680,3465:16780681,3466:16780682,3467:16780683,3468:16780684,3469:16780685,3470:16780686,3471:16780687,3472:16780688,3473:16780689,3474:16780690,3475:16780691,3476:16780692,3477:16780693,3478:16780694,3482:16780698,3483:16780699,3484:16780700,3485:16780701,3486:16780702,3487:16780703,3488:16780704,3489:16780705,3490:16780706,3491:16780707,3492:16780708,3493:16780709,3494:16780710,3495:16780711,3496:16780712,3497:16780713,3498:16780714,3499:16780715,3500:16780716,3501:16780717,3502:16780718,3503:16780719,3504:16780720,3505:16780721,3507:16780723,3508:16780724,3509:16780725,3510:16780726,3511:16780727,3512:16780728,3513:16780729,3514:16780730,3515:16780731,3517:16780733,3520:16780736,3521:16780737,3522:16780738,3523:16780739,3524:16780740,3525:16780741,3526:16780742,3530:16780746,3535:16780751,3536:16780752,3537:16780753,3538:16780754,3539:16780755,3540:16780756,3542:16780758,3544:16780760,3545:16780761,3546:16780762,3547:16780763,3548:16780764,3549:16780765,3550:16780766,3551:16780767,3570:16780786,3571:16780787,3572:16780788,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,4304:16781520,4305:16781521,4306:16781522,4307:16781523,4308:16781524,4309:16781525,4310:16781526,4311:16781527,4312:16781528,4313:16781529,4314:16781530,4315:16781531,4316:16781532,4317:16781533,4318:16781534,4319:16781535,4320:16781536,4321:16781537,4322:16781538,4323:16781539,4324:16781540,4325:16781541,4326:16781542,4327:16781543,4328:16781544,4329:16781545,4330:16781546,4331:16781547,4332:16781548,4333:16781549,4334:16781550,4335:16781551,4336:16781552,4337:16781553,4338:16781554,4339:16781555,4340:16781556,4341:16781557,4342:16781558,7682:16784898,7683:16784899,7690:16784906,7691:16784907,7710:16784926,7711:16784927,7734:16784950,7735:16784951,7744:16784960,7745:16784961,7766:16784982,7767:16784983,7776:16784992,7777:16784993,7786:16785002,7787:16785003,7808:16785024,7809:16785025,7810:16785026,7811:16785027,7812:16785028,7813:16785029,7818:16785034,7819:16785035,7840:16785056,7841:16785057,7842:16785058,7843:16785059,7844:16785060,7845:16785061,7846:16785062,7847:16785063,7848:16785064,7849:16785065,7850:16785066,7851:16785067,7852:16785068,7853:16785069,7854:16785070,7855:16785071,7856:16785072,7857:16785073,7858:16785074,7859:16785075,7860:16785076,7861:16785077,7862:16785078,7863:16785079,7864:16785080,7865:16785081,7866:16785082,7867:16785083,7868:16785084,7869:16785085,7870:16785086,7871:16785087,7872:16785088,7873:16785089,7874:16785090,7875:16785091,7876:16785092,7877:16785093,7878:16785094,7879:16785095,7880:16785096,7881:16785097,7882:16785098,7883:16785099,7884:16785100,7885:16785101,7886:16785102,7887:16785103,7888:16785104,7889:16785105,7890:16785106,7891:16785107,7892:16785108,7893:16785109,7894:16785110,7895:16785111,7896:16785112,7897:16785113,7898:16785114,7899:16785115,7900:16785116,7901:16785117,7902:16785118,7903:16785119,7904:16785120,7905:16785121,7906:16785122,7907:16785123,7908:16785124,7909:16785125,7910:16785126,7911:16785127,7912:16785128,7913:16785129,7914:16785130,7915:16785131,7916:16785132,7917:16785133,7918:16785134,7919:16785135,7920:16785136,7921:16785137,7922:16785138,7923:16785139,7924:16785140,7925:16785141,7926:16785142,7927:16785143,7928:16785144,7929:16785145,8194:2722,8195:2721,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8210:2747,8211:2730,8212:2729,8213:1967,8215:3295,8216:2768,8217:2769,8218:2813,8220:2770,8221:2771,8222:2814,8224:2801,8225:2802,8226:2790,8229:2735,8230:2734,8240:2773,8242:2774,8243:2775,8248:2812,8254:1150,8304:16785520,8308:16785524,8309:16785525,8310:16785526,8311:16785527,8312:16785528,8313:16785529,8320:16785536,8321:16785537,8322:16785538,8323:16785539,8324:16785540,8325:16785541,8326:16785542,8327:16785543,8328:16785544,8329:16785545,8352:16785568,8353:16785569,8354:16785570,8355:16785571,8356:16785572,8357:16785573,8358:16785574,8359:16785575,8360:16785576,8361:3839,8362:16785578,8363:16785579,8364:8364,8453:2744,8470:1712,8471:2811,8478:2772,8482:2761,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8539:2755,8540:2756,8541:2757,8542:2758,8592:2299,8593:2300,8594:2301,8595:2302,8658:2254,8660:2253,8706:2287,8709:16785925,8711:2245,8712:16785928,8713:16785929,8715:16785931,8728:3018,8730:2262,8731:16785947,8732:16785948,8733:2241,8734:2242,8743:2270,8744:2271,8745:2268,8746:2269,8747:2239,8748:16785964,8749:16785965,8756:2240,8757:16785973,8764:2248,8771:2249,8773:16785992,8775:16785991,8800:2237,8801:2255,8802:16786018,8803:16786019,8804:2236,8805:2238,8834:2266,8835:2267,8866:3068,8867:3036,8868:3010,8869:3022,8968:3027,8970:3012,8981:2810,8992:2212,8993:2213,9109:3020,9115:2219,9117:2220,9118:2221,9120:2222,9121:2215,9123:2216,9124:2217,9126:2218,9128:2223,9132:2224,9143:2209,9146:2543,9147:2544,9148:2546,9149:2547,9225:2530,9226:2533,9227:2537,9228:2531,9229:2532,9251:2732,9252:2536,9472:2211,9474:2214,9484:2210,9488:2539,9492:2541,9496:2538,9500:2548,9508:2549,9516:2551,9524:2550,9532:2542,9618:2529,9642:2791,9643:2785,9644:2779,9645:2786,9646:2783,9647:2767,9650:2792,9651:2787,9654:2781,9655:2765,9660:2793,9661:2788,9664:2780,9665:2764,9670:2528,9675:2766,9679:2782,9702:2784,9734:2789,9742:2809,9747:2762,9756:2794,9758:2795,9792:2808,9794:2807,9827:2796,9829:2798,9830:2797,9837:2806,9839:2805,10003:2803,10007:2804,10013:2777,10016:2800,10216:2748,10217:2750,10240:16787456,10241:16787457,10242:16787458,10243:16787459,10244:16787460,10245:16787461,10246:16787462,10247:16787463,10248:16787464,10249:16787465,10250:16787466,10251:16787467,10252:16787468,10253:16787469,10254:16787470,10255:16787471,10256:16787472,10257:16787473,10258:16787474,10259:16787475,10260:16787476,10261:16787477,10262:16787478,10263:16787479,10264:16787480,10265:16787481,10266:16787482,10267:16787483,10268:16787484,10269:16787485,10270:16787486,10271:16787487,10272:16787488,10273:16787489,10274:16787490,10275:16787491,10276:16787492,10277:16787493,10278:16787494,10279:16787495,10280:16787496,10281:16787497,10282:16787498,10283:16787499,10284:16787500,10285:16787501,10286:16787502,10287:16787503,10288:16787504,10289:16787505,10290:16787506,10291:16787507,10292:16787508,10293:16787509,10294:16787510,10295:16787511,10296:16787512,10297:16787513,10298:16787514,10299:16787515,10300:16787516,10301:16787517,10302:16787518,10303:16787519,10304:16787520,10305:16787521,10306:16787522,10307:16787523,10308:16787524,10309:16787525,10310:16787526,10311:16787527,10312:16787528,10313:16787529,10314:16787530,10315:16787531,10316:16787532,10317:16787533,10318:16787534,10319:16787535,10320:16787536,10321:16787537,10322:16787538,10323:16787539,10324:16787540,10325:16787541,10326:16787542,10327:16787543,10328:16787544,10329:16787545,10330:16787546,10331:16787547,10332:16787548,10333:16787549,10334:16787550,10335:16787551,10336:16787552,10337:16787553,10338:16787554,10339:16787555,10340:16787556,10341:16787557,10342:16787558,10343:16787559,10344:16787560,10345:16787561,10346:16787562,10347:16787563,10348:16787564,10349:16787565,10350:16787566,10351:16787567,10352:16787568,10353:16787569,10354:16787570,10355:16787571,10356:16787572,10357:16787573,10358:16787574,10359:16787575,10360:16787576,10361:16787577,10362:16787578,10363:16787579,10364:16787580,10365:16787581,10366:16787582,10367:16787583,10368:16787584,10369:16787585,10370:16787586,10371:16787587,10372:16787588,10373:16787589,10374:16787590,10375:16787591,10376:16787592,10377:16787593,10378:16787594,10379:16787595,10380:16787596,10381:16787597,10382:16787598,10383:16787599,10384:16787600,10385:16787601,10386:16787602,10387:16787603,10388:16787604,10389:16787605,10390:16787606,10391:16787607,10392:16787608,10393:16787609,10394:16787610,10395:16787611,10396:16787612,10397:16787613,10398:16787614,10399:16787615,10400:16787616,10401:16787617,10402:16787618,10403:16787619,10404:16787620,10405:16787621,10406:16787622,10407:16787623,10408:16787624,10409:16787625,10410:16787626,10411:16787627,10412:16787628,10413:16787629,10414:16787630,10415:16787631,10416:16787632,10417:16787633,10418:16787634,10419:16787635,10420:16787636,10421:16787637,10422:16787638,10423:16787639,10424:16787640,10425:16787641,10426:16787642,10427:16787643,10428:16787644,10429:16787645,10430:16787646,10431:16787647,10432:16787648,10433:16787649,10434:16787650,10435:16787651,10436:16787652,10437:16787653,10438:16787654,10439:16787655,10440:16787656,10441:16787657,10442:16787658,10443:16787659,10444:16787660,10445:16787661,10446:16787662,10447:16787663,10448:16787664,10449:16787665,10450:16787666,10451:16787667,10452:16787668,10453:16787669,10454:16787670,10455:16787671,10456:16787672,10457:16787673,10458:16787674,10459:16787675,10460:16787676,10461:16787677,10462:16787678,10463:16787679,10464:16787680,10465:16787681,10466:16787682,10467:16787683,10468:16787684,10469:16787685,10470:16787686,10471:16787687,10472:16787688,10473:16787689,10474:16787690,10475:16787691,10476:16787692,10477:16787693,10478:16787694,10479:16787695,10480:16787696,10481:16787697,10482:16787698,10483:16787699,10484:16787700,10485:16787701,10486:16787702,10487:16787703,10488:16787704,10489:16787705,10490:16787706,10491:16787707,10492:16787708,10493:16787709,10494:16787710,10495:16787711,12289:1188,12290:1185,12300:1186,12301:1187,12443:1246,12444:1247,12449:1191,12450:1201,12451:1192,12452:1202,12453:1193,12454:1203,12455:1194,12456:1204,12457:1195,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12483:1199,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12515:1196,12516:1236,12517:1197,12518:1237,12519:1198,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12530:1190,12531:1245,12539:1189,12540:1200};n.lookup=i,n.fromUnicode=r,e.exports=n},{}],12:[function(t,e,s){function i(t){n("new()"),t=t||{},this._rfb_url=null,this._rfb_password="",this._rfb_state="disconnected",this._rfb_version=0,this._rfb_max_version=3.8,this._rfb_auth_scheme="",this._rfb_tightvnc=!1,this._rfb_xvp_ver=0,this._encodings=[["COPYRECT",1],["TIGHT",7],["TIGHT_PNG",-260],["HEXTILE",5],["RRE",2],["RAW",0],["DesktopSize",-223],["Cursor",-239],["JPEG_quality_med",-26],["compress_hi",-247],["last_rect",-224],["xvp",-309],["ExtendedDesktopSize",-308]],this._encHandlers={},this._encNames={},this._encStats={},this._sock=null,this._display=null,this._keyboard=null,this._mouse=null,this._sendTimer=null,this._disconnTimer=null,this._msgTimer=null,this._FBU={rects:0,subrects:0,lines:0,tiles:0,bytes:0,x:0,y:0,width:0,height:0,encoding:0,subencoding:-1,background:null,zlib:[]},this._fb_Bpp=4,this._fb_depth=3,this._fb_width=0,this._fb_height=0,this._fb_name="",this._rre_chunk_sz=100,this._timing={last_fbu:0,fbu_total:0,fbu_total_cnt:0,full_fbu_total:0,full_fbu_cnt:0,fbu_rt_start:0,fbu_rt_total:0,fbu_rt_cnt:0,pixels:0},this._supportsSetDesktopSize=!1,this._screen_id=0,this._screen_flags=0,this._mouse_buttonMask=0,this._mouse_arr=[],this._viewportDragging=!1,this._viewportDragPos={},h.set_defaults(this,t,{target:"null",focusContainer:document,encrypt:!1,true_color:!0,local_cursor:!1,shared:!0,view_only:!1,xvp_password_sep:"@",disconnectTimeout:3,wsProtocols:["binary","base64"],repeaterID:"",viewportDrag:!1,forceAuthScheme:0,enableMouseAndTouch:!1,onUpdateState:function(){},onPasswordRequired:function(){},onClipboard:function(){},onBell:function(){},onFBUReceive:function(){},onFBUComplete:function(){},onFBResize:function(){},onDesktopName:function(){},onXvpInit:function(){},onUnknownMessageType:null}),Object.keys(i.encodingHandlers).forEach(function(t){this._encHandlers[t]=i.encodingHandlers[t].bind(this)}.bind(this));for(var e=0;e<this._encodings.length;e++)this._encHandlers[this._encodings[e][1]]=this._encHandlers[this._encodings[e][0]],this._encNames[this._encodings[e][1]]=this._encodings[e][0],this._encStats[this._encodings[e][1]]=[0,0];try{this._display=new d({target:this._target})}catch(t){throw o("Display exception: "+t),t}this._keyboard=new u({target:this._focusContainer,onKeyPress:this._handleKeyPress.bind(this)}),this._mouse=new l({target:this._target,onMouseButton:this._handleMouseButton.bind(this),onMouseMove:this._handleMouseMove.bind(this),notify:this._keyboard.sync.bind(this._keyboard),enableMouseAndTouch:this._enableMouseAndTouch}),this._sock=new a,this._sock.on("message",this._handle_message.bind(this)),this._sock.on("open",function(){"connect"===this._rfb_state?this._updateState("ProtocolVersion","Starting VNC handshake"):this._fail("Got unexpected WebSocket connection")}.bind(this)),this._sock.on("close",function(t){n("WebSocket closed");var e="";t.code&&(e=" (code: "+t.code,t.reason&&(e+=", reason: "+t.reason),e+=")"),"disconnect"===this._rfb_state?this._updateState("disconnected","VNC disconnected"+e):"ProtocolVersion"===this._rfb_state?this._fail("Failed to connect to server"+e):this._rfb_state in{failed:1,disconnected:1}?n("Received onclose while disconnected"+e):this._fail("Server disconnected"+e),this._sock.off("close")}.bind(this)),this._sock.on("error",function(){o("WebSocket error")}),this._init_vars();var s=this._display.get_render_mode();this._updateState("loaded","noVNC ready: "+s)}function r(t){return";base64,"+f.encode(t)}e.exports=i;var n=t("debug")("noVNC:RFB"),o=t("debug")("noVNC:ERROR:RFB");o.log=console.warn.bind(console);var h=t("./util"),a=t("./websock"),_=t("./keys"),c=t("./input"),u=c.Keyboard,l=c.Mouse,d=t("./display"),f=t("./base64"),p=t("./des"),g=t("./tinf");i.prototype={connect:function(t,e){this._rfb_url=t,this._rfb_password=void 0!==e?e:"",this._updateState("connect","Connecting")},disconnect:function(){this._updateState("disconnect","Disconnecting"),this._sock.off("error"),this._sock.off("message"),this._sock.off("open")},sendPassword:function(t){this._rfb_password=t,this._rfb_state="Authentication",setTimeout(this._init_msg.bind(this),1)},sendCtrlAltDel:function(){
if("normal"!==this._rfb_state||this._view_only)return!1;var t=[];t=t.concat(i.messages.keyEvent(_.XK_Control_L,1)),t=t.concat(i.messages.keyEvent(_.XK_Alt_L,1)),t=t.concat(i.messages.keyEvent(_.XK_Delete,1)),t=t.concat(i.messages.keyEvent(_.XK_Delete,0)),t=t.concat(i.messages.keyEvent(_.XK_Alt_L,0)),t=t.concat(i.messages.keyEvent(_.XK_Control_L,0)),this._sock.send(t)},xvpOp:function(t,e){return!(this._rfb_xvp_ver<t)&&(n("xvpOp() | sending XVP operation "+e+" (version "+t+")"),this._sock.send_string("\0"+String.fromCharCode(t)+String.fromCharCode(e)),!0)},xvpShutdown:function(){return this.xvpOp(1,2)},xvpReboot:function(){return this.xvpOp(1,3)},xvpReset:function(){return this.xvpOp(1,4)},sendKey:function(t,e){if("normal"!==this._rfb_state||this._view_only)return!1;var s=[];void 0!==e?(n("sendKey() | sending key code ("+(e?"down":"up")+"): "+t),s=s.concat(i.messages.keyEvent(t,e?1:0))):(n("sendKey() | sending key code (down + up): "+t),s=s.concat(i.messages.keyEvent(t,1)),s=s.concat(i.messages.keyEvent(t,0))),this._sock.send(s)},clipboardPasteFrom:function(t){"normal"===this._rfb_state&&this._sock.send(i.messages.clientCutText(t))},setDesktopSize:function(t,e){if("normal"===this._rfb_state&&this._supportsSetDesktopSize){var s=[251];h.push8(s,0),h.push16(s,t),h.push16(s,e),h.push8(s,1),h.push8(s,0),h.push32(s,this._screen_id),h.push16(s,0),h.push16(s,0),h.push16(s,t),h.push16(s,e),h.push32(s,this._screen_flags),this._sock.send(s)}},_connect:function(){n("_connect() | connecting to "+this._rfb_url),this._sock.open(this._rfb_url,this._wsProtocols)},_init_vars:function(){this._sock.init(),this._FBU.rects=0,this._FBU.subrects=0,this._FBU.lines=0,this._FBU.tiles=0,this._FBU.zlibs=[],this._mouse_buttonMask=0,this._mouse_arr=[],this._rfb_tightvnc=!1;var t;for(t=0;t<this._encodings.length;t++)this._encStats[this._encodings[t][1]][0]=0;for(t=0;t<4;t++)this._FBU.zlibs[t]=new g,this._FBU.zlibs[t].init()},_print_stats:function(){n("_print_stats() | encoding stats for this connection:");var t,e;for(t=0;t<this._encodings.length;t++)e=this._encStats[this._encodings[t][1]],e[0]+e[1]>0&&n("_print_stats() | "+this._encodings[t][0]+": "+e[0]+" rects");for(n("_print_stats() | encoding stats since page load:"),t=0;t<this._encodings.length;t++)e=this._encStats[this._encodings[t][1]],n("_print_stats() | "+this._encodings[t][0]+": "+e[1]+" rects")},_cleanupSocket:function(t){this._sendTimer&&(clearInterval(this._sendTimer),this._sendTimer=null),this._msgTimer&&(clearInterval(this._msgTimer),this._msgTimer=null),this._display&&this._display.get_context()&&(this._keyboard.ungrab(),this._mouse.ungrab(),"connect"!==t&&"loaded"!==t&&this._display.defaultCursor(),this._display.clear()),this._sock.close()},_updateState:function(t,e){n('_updateState() | [state:%s, msg:"%s"]',t,e);var s=this._rfb_state;if(t===s)return void n('_updateState() | already in state "'+t+'", ignoring');switch(t in{disconnected:1,loaded:1,connect:1,disconnect:1,failed:1,fatal:1}&&this._cleanupSocket(t),"fatal"===s&&o("_updateState() | fatal error, cannot continue"),!e||"failed"!==t&&"fatal"!==t||o("_updateState() | %s: %s",t,e),this._rfb_state="failed"===s&&"disconnected"===t?"failed":t,this._disconnTimer&&"disconnect"!==this._rfb_state&&(n("_updateState() | clearing disconnect timer"),clearTimeout(this._disconnTimer),this._disconnTimer=null,this._sock.off("close")),t){case"normal":"disconnected"!==s&&"failed"!==s||o('_updateState() | invalid transition from "disconnected" or "failed" to "normal"');break;case"connect":this._init_vars(),this._connect();break;case"disconnect":this._disconnTimer=setTimeout(function(){this._fail("Disconnect timeout")}.bind(this),1e3*this._disconnectTimeout),this._print_stats();break;case"failed":"disconnected"===s?o('_updateState() | invalid transition from "disconnected" to "failed"'):"normal"===s?o("_updateState() | error while connected"):"init"===s&&o("_updateState() | error while initializing"),setTimeout(function(){this._updateState("disconnected")}.bind(this),50)}"failed"===s&&"disconnected"===t?this._onUpdateState(this,t,s):this._onUpdateState(this,t,s,e)},_fail:function(t){return this._updateState("failed",t),!1},_handle_message:function(){if(0===this._sock.rQlen())return void o("_handle_message() | called on an empty receive queue");switch(this._rfb_state){case"disconnected":case"failed":o("_handle_message() | got data while disconnected");break;case"normal":this._normal_msg()&&this._sock.rQlen()>0&&(null===this._msgTimer?(n("_handle_message() | more data to process, creating timer"),this._msgTimer=setTimeout(function(){this._msgTimer=null,this._handle_message()}.bind(this),10)):n("_handle_message() | more data to process, existing timer"));break;default:this._init_msg()}},_checkEvents:function(){"normal"===this._rfb_state&&!this._viewportDragging&&this._mouse_arr.length>0&&(this._sock.send(this._mouse_arr),this._mouse_arr=[])},_handleKeyPress:function(t,e){this._view_only||this._sock.send(i.messages.keyEvent(t,e))},_handleMouseButton:function(t,e,s,r){if(s?this._mouse_buttonMask|=r:this._mouse_buttonMask^=r,this._viewportDrag){if(s&&!this._viewportDragging)return this._viewportDragging=!0,void(this._viewportDragPos={x:t,y:e});this._viewportDragging=!1}this._view_only||(this._mouse_arr=this._mouse_arr.concat(i.messages.pointerEvent(this._display.absX(t),this._display.absY(e),this._mouse_buttonMask)),this._sock.send(this._mouse_arr),this._mouse_arr=[])},_handleMouseMove:function(t,e){if(this._viewportDragging){var s=this._viewportDragPos.x-t,r=this._viewportDragPos.y-e;return this._viewportDragPos={x:t,y:e},void this._display.viewportChangePos(s,r)}this._view_only||(this._mouse_arr=this._mouse_arr.concat(i.messages.pointerEvent(this._display.absX(t),this._display.absY(e),this._mouse_buttonMask)),this._checkEvents())},_negotiate_protocol_version:function(){if(this._sock.rQlen()<12)return this._fail("Incomplete protocol version");var t=this._sock.rQshiftStr(12).substr(4,7);n("_negotiate_protocol_version() | server ProtocolVersion: "+t);var e=0;switch(t){case"000.000":e=1;break;case"003.003":case"003.006":case"003.889":this._rfb_version=3.3;break;case"003.007":this._rfb_version=3.7;break;case"003.008":case"004.000":case"004.001":this._rfb_version=3.8;break;default:return this._fail("Invalid server version "+t)}if(e){for(var s=this._repeaterID;s.length<250;)s+="\0";return this._sock.send_string(s),!0}this._rfb_version>this._rfb_max_version&&(this._rfb_version=this._rfb_max_version),this._sendTimer=setInterval(this._sock.flush.bind(this._sock),50);var i="00"+parseInt(this._rfb_version,10)+".00"+10*this._rfb_version%10;this._sock.send_string("RFB "+i+"\n"),this._updateState("Security","Sent ProtocolVersion: "+i)},_negotiate_security:function(){if(this._rfb_version>=3.7){var t=this._sock.rQshift8();if(this._sock.rQwait("security type",t,1))return!1;if(0===t){var e=this._sock.rQshift32(),s=this._sock.rQshiftStr(e);return this._fail("Security failure: "+s)}this._rfb_auth_scheme=0;var i=this._sock.rQshiftBytes(t);if(n("_negotiate_security() | server security types: "+i),this._forceAuthScheme)this._rfb_auth_scheme=this._forceAuthScheme;else for(var r=0;r<i.length;r++)i[r]>this._rfb_auth_scheme&&(i[r]<=16||22===i[r])&&(this._rfb_auth_scheme=i[r]);if(0===this._rfb_auth_scheme)return this._fail("Unsupported security types: "+i);this._sock.send([this._rfb_auth_scheme])}else{if(this._sock.rQwait("security scheme",4))return!1;this._rfb_auth_scheme=this._sock.rQshift32()}return this._updateState("Authentication","Authenticating using scheme: "+this._rfb_auth_scheme),this._init_msg()},_negotiate_xvp_auth:function(){var t=this._xvp_password_sep,e=this._rfb_password.split(t);if(e.length<3)return this._updateState("password","XVP credentials required (user"+t+"target"+t+"password) -- got only "+this._rfb_password),this._onPasswordRequired(this),!1;var s=String.fromCharCode(e[0].length)+String.fromCharCode(e[1].length)+e[0]+e[1];return this._sock.send_string(s),this._rfb_password=e.slice(2).join(t),this._rfb_auth_scheme=2,this._negotiate_authentication()},_negotiate_std_vnc_auth:function(){if(0===this._rfb_password.length&&(this._updateState("password","Password Required"),this._onPasswordRequired(this)),this._sock.rQwait("auth challenge",16))return!1;var t=this._sock.rQshiftBytes(16),e=i.genDES(this._rfb_password,t);return this._sock.send(e),this._updateState("SecurityResult"),!0},_negotiate_tight_tunnels:function(t){for(var e={0:{vendor:"TGHT",signature:"NOTUNNEL"}},s={},i=0;i<t;i++){var r=this._sock.rQshift32(),n=this._sock.rQshiftStr(4),o=this._sock.rQshiftStr(8);s[r]={vendor:n,signature:o}}return s[0]?s[0].vendor!==e[0].vendor||s[0].signature!==e[0].signature?this._fail("Client's tunnel type had the incorrect vendor or signature"):(this._sock.send([0,0,0,0]),!1):this._fail("Server wanted tunnels, but doesn't support the notunnel type")},_negotiate_tight_auth:function(){if(!this._rfb_tightvnc){if(this._sock.rQwait("num tunnels",4))return!1;var t=this._sock.rQshift32();if(t>0&&this._sock.rQwait("tunnel capabilities",16*t,4))return!1;if(this._rfb_tightvnc=!0,t>0)return this._negotiate_tight_tunnels(t),!1}if(this._sock.rQwait("sub auth count",4))return!1;var e=this._sock.rQshift32();if(this._sock.rQwait("sub auth capabilities",16*e,4))return!1;for(var s={STDVNOAUTH__:1,STDVVNCAUTH_:2},i=[],r=0;r<e;r++){var o=this._sock.rQshiftStr(12);i.push(o)}n("_negotiate_tight_auth() | clientSupportedTypes: %o",s),n("_negotiate_tight_auth() | serverSupportedTypes: %o",i);for(var h in s)if(-1!==i.indexOf(h))switch(this._sock.send([0,0,0,s[h]]),h){case"STDVNOAUTH__":return this._updateState("SecurityResult"),!0;case"STDVVNCAUTH_":return this._rfb_auth_scheme=2,this._init_msg();default:return this._fail("Unsupported tiny auth scheme: "+h)}this._fail("No supported sub-auth types!")},_negotiate_authentication:function(){switch(this._rfb_auth_scheme){case 0:if(this._sock.rQwait("auth reason",4))return!1;var t=this._sock.rQshift32(),e=this._sock.rQshiftStr(t);return this._fail("Auth failure: "+e);case 1:return this._rfb_version>=3.8?(this._updateState("SecurityResult"),!0):(this._updateState("ClientInitialisation","No auth required"),this._init_msg());case 22:return this._negotiate_xvp_auth();case 2:return this._negotiate_std_vnc_auth();case 16:return this._negotiate_tight_auth();default:return this._fail("Unsupported auth scheme: "+this._rfb_auth_scheme)}},_handle_security_result:function(){if(this._sock.rQwait("VNC auth response ",4))return!1;switch(this._sock.rQshift32()){case 0:return this._updateState("ClientInitialisation","Authentication OK"),this._init_msg();case 1:if(this._rfb_version>=3.8){var t=this._sock.rQshift32();if(this._sock.rQwait("SecurityResult reason",t,8))return!1;var e=this._sock.rQshiftStr(t);return this._fail(e)}return this._fail("Authentication failure");case 2:return this._fail("Too many auth attempts")}},_negotiate_server_init:function(){if(this._sock.rQwait("server initialization",24))return!1;this._fb_width=this._sock.rQshift16(),this._fb_height=this._sock.rQshift16();var t=this._sock.rQshift8(),e=this._sock.rQshift8(),s=this._sock.rQshift8(),r=this._sock.rQshift8(),a=this._sock.rQshift16(),_=this._sock.rQshift16(),c=this._sock.rQshift16(),u=this._sock.rQshift8(),l=this._sock.rQshift8(),d=this._sock.rQshift8();this._sock.rQskipBytes(3);var f=this._sock.rQshift32();if(this._sock.rQwait("server init name",f,24))return!1;if(this._fb_name=h.decodeUTF8(this._sock.rQshiftStr(f)),this._rfb_tightvnc){if(this._sock.rQwait("TightVNC extended server init header",8,24+f))return!1;var p=this._sock.rQshift16(),g=this._sock.rQshift16(),b=this._sock.rQshift16();this._sock.rQskipBytes(2);var v=16*(p+g+b);if(this._sock.rQwait("TightVNC extended server init header",v,32+f))return!1;var y;for(y=0;y<p;y++)this._sock.rQshiftStr(16);for(y=0;y<g;y++)this._sock.rQshiftStr(16);for(y=0;y<b;y++)this._sock.rQshiftStr(16)}n("_negotiate_server_init() | screen: "+this._fb_width+"x"+this._fb_height+", bpp: "+t+", depth: "+e+", big_endian: "+s+", true_color: "+r+", red_max: "+a+", green_max: "+_+", blue_max: "+c+", red_shift: "+u+", green_shift: "+l+", blue_shift: "+d),0!==s&&o("_negotiate_server_init() | server native endian is not little endian"),16!==u&&o("_negotiate_server_init() | server native red-shift is not 16"),0!==d&&o("_negotiate_server_init() | server native blue-shift is not 0"),this._onDesktopName(this,this._fb_name),this._true_color&&"Intel(r) AMT KVM"===this._fb_name&&(o("_negotiate_server_init() | Intel AMT KVM only supports 8/16 bit depths, disabling true color"),this._true_color=!1),this._display.set_true_color(this._true_color),this._display.resize(this._fb_width,this._fb_height),this._onFBResize(this,this._fb_width,this._fb_height),this._keyboard.grab(),this._mouse.grab(),this._true_color?(this._fb_Bpp=4,this._fb_depth=3):(this._fb_Bpp=1,this._fb_depth=1);var m=i.messages.pixelFormat(this._fb_Bpp,this._fb_depth,this._true_color);m=m.concat(i.messages.clientEncodings(this._encodings,this._local_cursor,this._true_color)),m=m.concat(i.messages.fbUpdateRequests(this._display.getCleanDirtyReset(),this._fb_width,this._fb_height)),this._timing.fbu_rt_start=(new Date).getTime(),this._timing.pixels=0,this._sock.send(m),this._checkEvents(),this._updateState("normal","Connected to: "+this._fb_name)},_init_msg:function(){switch(this._rfb_state){case"ProtocolVersion":return this._negotiate_protocol_version();case"Security":return this._negotiate_security();case"Authentication":return this._negotiate_authentication();case"SecurityResult":return this._handle_security_result();case"ClientInitialisation":return this._sock.send([this._shared?1:0]),this._updateState("ServerInitialisation","Authentication OK"),!0;case"ServerInitialisation":return this._negotiate_server_init()}},_handle_set_colour_map_msg:function(){n("_handle_set_colour_map_msg()"),this._sock.rQskip8();var t=this._sock.rQshift16(),e=this._sock.rQshift16();if(this._sock.rQwait("SetColorMapEntries",6*e,6))return!1;for(var s=0;s<e;s++){var i=parseInt(this._sock.rQshift16()/256,10),r=parseInt(this._sock.rQshift16()/256,10),o=parseInt(this._sock.rQshift16()/256,10);this._display.set_colourMap([o,r,i],t+s)}return n("_handle_set_colour_map_msg() | colourMap: "+this._display.get_colourMap()),n("_handle_set_colour_map_msg() | registered "+e+" colourMap entries"),!0},_handle_server_cut_text:function(){if(n("_handle_server_cut_text()"),this._sock.rQwait("ServerCutText header",7,1))return!1;this._sock.rQskipBytes(3);var t=this._sock.rQshift32();if(this._sock.rQwait("ServerCutText",t,8))return!1;var e=this._sock.rQshiftStr(t);return this._onClipboard(this,e),!0},_handle_xvp_msg:function(){if(this._sock.rQwait("XVP version and message",3,1))return!1;this._sock.rQskip8();var t=this._sock.rQshift8(),e=this._sock.rQshift8();switch(e){case 0:this._updateState(this._rfb_state,"Operation Failed");break;case 1:this._rfb_xvp_ver=t,n("_handle_xvp_msg() | XVP extensions enabled (version "+this._rfb_xvp_ver+")"),this._onXvpInit(this._rfb_xvp_ver);break;default:this._fail("Disconnected: illegal server XVP message "+e)}return!0},_normal_msg:function(){var t;switch(t=this._FBU.rects>0?0:this._sock.rQshift8()){case 0:var e=this._framebufferUpdate();return e&&this._sock.send(i.messages.fbUpdateRequests(this._display.getCleanDirtyReset(),this._fb_width,this._fb_height)),e;case 1:return this._handle_set_colour_map_msg();case 2:return n("_normal_msg() | bell"),this._onBell(this),!0;case 3:return this._handle_server_cut_text();case 250:return this._handle_xvp_msg();default:if(!this._onUnknownMessageType)return this._fail("Disconnected: illegal server message type "+t),o("_normal_msg() | sock.rQslice(0, 30): "+this._sock.rQslice(0,30)),!0;n("_normal_msg() | passing unknown message type "+t+" to the onUnknownMessageType listener");try{return this._onUnknownMessageType(t,this._sock)}catch(e){return o("_normal_msg() | error catched during onUnknownMessageType: %o",e),this._fail("Disconnected: invalid custom server message type "+t),o("_normal_msg() | sock.rQslice(0, 30): "+this._sock.rQslice(0,30)),!0}}},_framebufferUpdate:function(){var t,e=!0;if(0===this._FBU.rects){if(this._sock.rQwait("FBU header",3,1))return!1;this._sock.rQskip8(),this._FBU.rects=this._sock.rQshift16(),this._FBU.bytes=0,this._timing.cur_fbu=0,this._timing.fbu_rt_start>0&&(t=(new Date).getTime(),n("_framebufferUpdate() | first FBU latency: "+(t-this._timing.fbu_rt_start)))}for(;this._FBU.rects>0;){if("normal"!==this._rfb_state)return!1;if(this._sock.rQwait("FBU",this._FBU.bytes))return!1;if(0===this._FBU.bytes){if(this._sock.rQwait("rect header",12))return!1;var s=this._sock.rQshiftBytes(12);if(this._FBU.x=(s[0]<<8)+s[1],this._FBU.y=(s[2]<<8)+s[3],this._FBU.width=(s[4]<<8)+s[5],this._FBU.height=(s[6]<<8)+s[7],this._FBU.encoding=parseInt((s[8]<<24)+(s[9]<<16)+(s[10]<<8)+s[11],10),this._onFBUReceive(this,{x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height,encoding:this._FBU.encoding,encodingName:this._encNames[this._FBU.encoding]}),!this._encNames[this._FBU.encoding])return this._fail("Disconnected: unsupported encoding "+this._FBU.encoding),!1}if(this._timing.last_fbu=(new Date).getTime(),e=this._encHandlers[this._FBU.encoding](),t=(new Date).getTime(),this._timing.cur_fbu+=t-this._timing.last_fbu,e&&(this._encStats[this._FBU.encoding][0]++,this._encStats[this._FBU.encoding][1]++,this._timing.pixels+=this._FBU.width*this._FBU.height),this._timing.pixels>=this._fb_width*this._fb_height&&((this._FBU.width===this._fb_width&&this._FBU.height===this._fb_height||this._timing.fbu_rt_start>0)&&(this._timing.full_fbu_total+=this._timing.cur_fbu,this._timing.full_fbu_cnt++,n("_framebufferUpdate() | timing of full FBU, curr: "+this._timing.cur_fbu+", total: "+this._timing.full_fbu_total+", cnt: "+this._timing.full_fbu_cnt+", avg: "+this._timing.full_fbu_total/this._timing.full_fbu_cnt)),this._timing.fbu_rt_start>0)){var i=t-this._timing.fbu_rt_start;this._timing.fbu_rt_total+=i,this._timing.fbu_rt_cnt++,n("_framebufferUpdate() | full FBU round-trip, cur: "+i+", total: "+this._timing.fbu_rt_total+", cnt: "+this._timing.fbu_rt_cnt+", avg: "+this._timing.fbu_rt_total/this._timing.fbu_rt_cnt),this._timing.fbu_rt_start=0}if(!e)return e}return this._onFBUComplete(this,{x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height,encoding:this._FBU.encoding,encodingName:this._encNames[this._FBU.encoding]}),!0}},h.make_properties(i,[["target","wo","dom"],["focusContainer","wo","dom"],["encrypt","rw","bool"],["true_color","rw","bool"],["local_cursor","rw","bool"],["shared","rw","bool"],["view_only","rw","bool"],["xvp_password_sep","rw","str"],["disconnectTimeout","rw","int"],["wsProtocols","rw","arr"],["repeaterID","rw","str"],["viewportDrag","rw","bool"],["forceAuthScheme","rw","int"],["enableMouseAndTouch","rw","bool"],["onUpdateState","rw","func"],["onPasswordRequired","rw","func"],["onClipboard","rw","func"],["onBell","rw","func"],["onFBUReceive","rw","func"],["onFBUComplete","rw","func"],["onFBResize","rw","func"],["onDesktopName","rw","func"],["onXvpInit","rw","func"],["onUnknownMessageType","rw","func"]]),i.prototype.set_local_cursor=function(t){!t||t in{0:1,no:1,false:1}?(this._local_cursor=!1,this._display.disableLocalCursor()):this._display.get_cursor_uri()?this._local_cursor=!0:(n("browser does not support local cursor"),this._display.disableLocalCursor())},i.prototype.get_display=function(){return this._display},i.prototype.get_keyboard=function(){return this._keyboard},i.prototype.get_mouse=function(){return this._mouse},i.messages={keyEvent:function(t,e){var s=[4];return h.push8(s,e),h.push16(s,0),h.push32(s,t),s},pointerEvent:function(t,e,s){var i=[5];return h.push8(i,s),h.push16(i,t),h.push16(i,e),i},clientCutText:function(t){var e=[6];h.push8(e,0),h.push8(e,0),h.push8(e,0),h.push32(e,t.length);for(var s=t.length,i=0;i<s;i++)e.push(t.charCodeAt(i));return e},pixelFormat:function(t,e,s){var i=[0];return h.push8(i,0),h.push8(i,0),h.push8(i,0),h.push8(i,8*t),h.push8(i,8*e),h.push8(i,0),h.push8(i,s?1:0),h.push16(i,255),h.push16(i,255),h.push16(i,255),h.push8(i,16),h.push8(i,8),h.push8(i,0),h.push8(i,0),h.push8(i,0),h.push8(i,0),i},clientEncodings:function(t,e,s){var i,r=[];for(i=0;i<t.length;i++)"Cursor"!==t[i][0]||e?"TIGHT"!==t[i][0]||s?r.push(t[i][1]):n("clientEncodings() | skipping tight as it is only supported with true color"):n("clientEncodings() | skipping Cursor pseudo-encoding");var o=[2];for(h.push8(o,0),h.push16(o,r.length),i=0;i<r.length;i++)h.push32(o,r[i]);return o},fbUpdateRequests:function(t,e,s){var r,n,o=[],h=t.cleanBox;h.w>0&&h.h>0&&(r=void 0===h.w?e:h.w,n=void 0===h.h?s:h.h,o=o.concat(i.messages.fbUpdateRequest(1,h.x,h.y,r,n)));for(var a=0;a<t.dirtyBoxes.length;a++){var _=t.dirtyBoxes[a];r=void 0===_.w?e:_.w,n=void 0===_.h?s:_.h,o=o.concat(i.messages.fbUpdateRequest(0,_.x,_.y,r,n))}return o},fbUpdateRequest:function(t,e,s,i,r){void 0===e&&(e=0),void 0===s&&(s=0);var n=[3];return h.push8(n,t),h.push16(n,e),h.push16(n,s),h.push16(n,i),h.push16(n,r),n}},i.genDES=function(t,e){for(var s=[],i=0;i<t.length;i++)s.push(t.charCodeAt(i));return new p(s).encrypt(e)},i.encodingHandlers={RAW:function(){if(0===this._FBU.lines&&(this._FBU.lines=this._FBU.height),this._FBU.bytes=this._FBU.width*this._fb_Bpp,this._sock.rQwait("RAW",this._FBU.bytes))return!1;var t=this._FBU.y+(this._FBU.height-this._FBU.lines),e=Math.min(this._FBU.lines,Math.floor(this._sock.rQlen()/(this._FBU.width*this._fb_Bpp)));return this._display.blitImage(this._FBU.x,t,this._FBU.width,e,this._sock.get_rQ(),this._sock.get_rQi()),this._sock.rQskipBytes(this._FBU.width*e*this._fb_Bpp),this._FBU.lines-=e,this._FBU.lines>0?this._FBU.bytes=this._FBU.width*this._fb_Bpp:(this._FBU.rects--,this._FBU.bytes=0),!0},COPYRECT:function(){return this._FBU.bytes=4,!this._sock.rQwait("COPYRECT",4)&&(this._display.renderQ_push({type:"copy",old_x:this._sock.rQshift16(),old_y:this._sock.rQshift16(),x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height}),this._FBU.rects--,this._FBU.bytes=0,!0)},RRE:function(){var t;if(0===this._FBU.subrects){if(this._FBU.bytes=4+this._fb_Bpp,this._sock.rQwait("RRE",4+this._fb_Bpp))return!1;this._FBU.subrects=this._sock.rQshift32(),t=this._sock.rQshiftBytes(this._fb_Bpp),this._display.fillRect(this._FBU.x,this._FBU.y,this._FBU.width,this._FBU.height,t)}for(;this._FBU.subrects>0&&this._sock.rQlen()>=this._fb_Bpp+8;){t=this._sock.rQshiftBytes(this._fb_Bpp);var e=this._sock.rQshift16(),s=this._sock.rQshift16(),i=this._sock.rQshift16(),r=this._sock.rQshift16();this._display.fillRect(this._FBU.x+e,this._FBU.y+s,i,r,t),this._FBU.subrects--}if(this._FBU.subrects>0){var n=Math.min(this._rre_chunk_sz,this._FBU.subrects);this._FBU.bytes=(this._fb_Bpp+8)*n}else this._FBU.rects--,this._FBU.bytes=0;return!0},HEXTILE:function(){var t=this._sock.get_rQ(),e=this._sock.get_rQi();for(0===this._FBU.tiles&&(this._FBU.tiles_x=Math.ceil(this._FBU.width/16),this._FBU.tiles_y=Math.ceil(this._FBU.height/16),this._FBU.total_tiles=this._FBU.tiles_x*this._FBU.tiles_y,this._FBU.tiles=this._FBU.total_tiles);this._FBU.tiles>0;){if(this._FBU.bytes=1,this._sock.rQwait("HEXTILE subencoding",this._FBU.bytes))return!1;var s=t[e];if(s>30)return this._fail("Disconnected: illegal hextile subencoding "+s),!1;var i=0,r=this._FBU.total_tiles-this._FBU.tiles,o=r%this._FBU.tiles_x,h=Math.floor(r/this._FBU.tiles_x),a=this._FBU.x+16*o,_=this._FBU.y+16*h,c=Math.min(16,this._FBU.x+this._FBU.width-a),u=Math.min(16,this._FBU.y+this._FBU.height-_);if(1&s)this._FBU.bytes+=c*u*this._fb_Bpp;else if(2&s&&(this._FBU.bytes+=this._fb_Bpp),4&s&&(this._FBU.bytes+=this._fb_Bpp),8&s){if(this._FBU.bytes++,this._sock.rQwait("hextile subrects header",this._FBU.bytes))return!1;i=t[e+this._FBU.bytes-1],this._FBU.bytes+=16&s?i*(this._fb_Bpp+2):2*i}if(this._sock.rQwait("hextile",this._FBU.bytes))return!1;if(this._FBU.subencoding=t[e],e++,0===this._FBU.subencoding)1&this._FBU.lastsubencoding?n("HEXTILE() | ignoring blank after RAW"):this._display.fillRect(a,_,c,u,this._FBU.background);else if(1&this._FBU.subencoding)this._display.blitImage(a,_,c,u,t,e),e+=this._FBU.bytes-1;else{if(2&this._FBU.subencoding&&(this._FBU.background=t.slice(e,e+this._fb_Bpp),e+=this._fb_Bpp),4&this._FBU.subencoding&&(this._FBU.foreground=t.slice(e,e+this._fb_Bpp),e+=this._fb_Bpp),this._display.startTile(a,_,c,u,this._FBU.background),8&this._FBU.subencoding){i=t[e],e++;for(var l=0;l<i;l++){var d;16&this._FBU.subencoding?(d=t.slice(e,e+this._fb_Bpp),e+=this._fb_Bpp):d=this._FBU.foreground;var f=t[e];e++;var p=f>>4,g=15&f,b=t[e];e++;var v=1+(b>>4),y=1+(15&b);this._display.subTile(p,g,v,y,d)}}this._display.finishTile()}this._sock.set_rQi(e),this._FBU.lastsubencoding=this._FBU.subencoding,this._FBU.bytes=0,this._FBU.tiles--}return 0===this._FBU.tiles&&this._FBU.rects--,!0},getTightCLength:function(t){var e=1,s=0;return s+=127&t[0],128&t[0]&&(e++,s+=(127&t[1])<<7,128&t[1]&&(e++,s+=t[2]<<14)),[e,s]},display_tight:function(t){if(1===this._fb_depth&&this._fail("Tight protocol handler only implements true color mode"),this._FBU.bytes=1,this._sock.rQwait("TIGHT compression-control",this._FBU.bytes))return!1;var e,s,h,a=0,_=-1,c=function(t){for(var e=0;e<4;e++)a>>e&1&&(this._FBU.zlibs[e].reset(),n("display_tight() | reset zlib stream "+e));var s=this._FBU.zlibs[_].uncompress(t,0);return 0!==s.status&&o("display_tight() | invalid data in zlib stream"),s.data}.bind(this),u=function(t,e,s,i,r){var n,o,h,a,_=[];if(2===e){var c=Math.floor((i+7)/8),u=Math.floor(i/8);for(o=0;o<r;o++){var l;for(n=0;n<u;n++)for(l=7;l>=0;l--)h=3*(o*i+8*n+7-l),a=3*(t[o*c+n]>>l&1),_[h]=s[a],_[h+1]=s[a+1],_[h+2]=s[a+2];for(l=7;l>=8-i%8;l--)h=3*(o*i+8*n+7-l),a=3*(t[o*c+n]>>l&1),_[h]=s[a],_[h+1]=s[a+1],_[h+2]=s[a+2]}}else for(o=0;o<r;o++)for(n=0;n<i;n++)h=3*(o*i+n),a=3*t[o*i+n],_[h]=s[a],_[h+1]=s[a+1],_[h+2]=s[a+2];return _}.bind(this),l=this._sock.get_rQ(),d=this._sock.get_rQi(),f=function(){var t=l[d+2]+1,r=t*this._fb_depth;if(this._FBU.bytes+=r,this._sock.rQwait("TIGHT palette "+e,this._FBU.bytes))return!1;var n=t<=2?1:8,o=Math.floor((this._FBU.width*n+7)/8),a=!1;if(o*this._FBU.height<12?(a=!0,s=[0,o*this._FBU.height]):s=i.encodingHandlers.getTightCLength(this._sock.rQslice(3+r,3+r+3)),this._FBU.bytes+=s[0]+s[1],this._sock.rQwait("TIGHT "+e,this._FBU.bytes))return!1;this._sock.rQskipBytes(3);var _=this._sock.rQshiftBytes(r);this._sock.rQskipBytes(s[0]),h=a?this._sock.rQshiftBytes(s[1]):c(this._sock.rQshiftBytes(s[1]));var f=u(h,t,_,this._FBU.width,this._FBU.height);return this._display.renderQ_push({type:"blitRgb",data:f,x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height}),!0}.bind(this),p=function(){var t=!1,r=this._FBU.width*this._FBU.height*this._fb_depth;return r<12?(t=!0,s=[0,r]):s=i.encodingHandlers.getTightCLength(this._sock.rQslice(1,4)),this._FBU.bytes=1+s[0]+s[1],!this._sock.rQwait("TIGHT "+e,this._FBU.bytes)&&(this._sock.rQshiftBytes(1+s[0]),h=t?this._sock.rQshiftBytes(s[1]):c(this._sock.rQshiftBytes(s[1])),this._display.renderQ_push({type:"blitRgb",data:h,x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height}),!0)}.bind(this),g=this._sock.rQpeek8();if(a=15&g,g>>=4,_=3&g,8===g)e="fill";else if(9===g)e="jpeg";else if(10===g)e="png";else if(4&g)e="filter";else{if(!(g<4))return this._fail("Illegal tight compression received, ctl: "+g);e="copy"}if(t&&("filter"===e||"copy"===e))return this._fail("filter/copy received in tightPNG mode");switch(e){case"fill":this._FBU.bytes+=this._fb_depth;break;case"jpeg":case"png":this._FBU.bytes+=3;break;case"filter":this._FBU.bytes+=2}if(this._sock.rQwait("TIGHT "+e,this._FBU.bytes))return!1;switch(e){case"fill":this._sock.rQskip8();var b=this._sock.rQshiftBytes(this._fb_depth);this._display.renderQ_push({type:"fill",x:this._FBU.x,y:this._FBU.y,width:this._FBU.width,height:this._FBU.height,color:[b[2],b[1],b[0]]});break;case"png":case"jpeg":if(s=i.encodingHandlers.getTightCLength(this._sock.rQslice(1,4)),this._FBU.bytes=1+s[0]+s[1],this._sock.rQwait("TIGHT "+e,this._FBU.bytes))return!1;this._sock.rQskipBytes(1+s[0]);var v=new Image;v.src="data: image/"+e+r(this._sock.rQshiftBytes(s[1])),this._display.renderQ_push({type:"img",img:v,x:this._FBU.x,y:this._FBU.y}),v=null;break;case"filter":var y=l[d+1];if(1!==y)throw new Error("Unsupported tight subencoding received, filter: "+y);if(!f())return!1;break;case"copy":if(!p())return!1}return this._FBU.bytes=0,this._FBU.rects--,!0},TIGHT:function(){return this._encHandlers.display_tight(!1)},TIGHT_PNG:function(){return this._encHandlers.display_tight(!0)},last_rect:function(){return this._FBU.rects=0,!0},handle_FB_resize:function(){return this._fb_width=this._FBU.width,this._fb_height=this._FBU.height,this._display.resize(this._fb_width,this._fb_height),this._onFBResize(this,this._fb_width,this._fb_height),this._timing.fbu_rt_start=(new Date).getTime(),this._FBU.bytes=0,this._FBU.rects-=1,!0},ExtendedDesktopSize:function(){if(this._FBU.bytes=1,this._sock.rQwait("ExtendedDesktopSize",this._FBU.bytes))return!1;this._supportsSetDesktopSize=!0;var t=this._sock.rQpeek8();if(this._FBU.bytes=4+16*t,this._sock.rQwait("ExtendedDesktopSize",this._FBU.bytes))return!1;this._sock.rQskipBytes(1),this._sock.rQskipBytes(3);for(var e=0;e<t;e+=1)0===e?(this._screen_id=this._sock.rQshiftBytes(4),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._sock.rQskipBytes(2),this._screen_flags=this._sock.rQshiftBytes(4)):this._sock.rQskipBytes(16);if(1===this._FBU.x&&0!==this._FBU.y){var s="";switch(this._FBU.y){case 1:s="resize is administratively prohibited";break;case 2:s="out of resources";break;case 3:s="invalid screen layout";break;default:s="unknown reason"}return n("ExtendedDesktopSize() | server did not accept the resize request: %s",s),!0}return this._encHandlers.handle_FB_resize(),!0},DesktopSize:function(){return n("DesktopSize()"),this._encHandlers.handle_FB_resize(),!0},Cursor:function(){n("Cursor()");var t=this._FBU.x,e=this._FBU.y,s=this._FBU.width,i=this._FBU.height,r=s*i*this._fb_Bpp,o=Math.floor((s+7)/8)*i;return this._FBU.bytes=r+o,!this._sock.rQwait("cursor encoding",this._FBU.bytes)&&(this._display.changeCursor(this._sock.rQshiftBytes(r),this._sock.rQshiftBytes(o),t,e,s,i),this._FBU.bytes=0,this._FBU.rects--,!0)},JPEG_quality_lo:function(){o("JPEG_quality_lo() | server sent jpeg_quality pseudo-encoding")},compress_lo:function(){o("compress_lo() | server sent compress level pseudo-encoding")}}},{"./base64":6,"./des":7,"./display":8,"./input":9,"./keys":11,"./tinf":13,"./util":14,"./websock":15,debug:2}],13:[function(t,e,s){function i(){this.OK=0,this.DATA_ERROR=-3,this.WINDOW_SIZE=32768,this.TREE=function(){this.table=new Array(16),this.trans=new Array(288)},this.DATA=function(t){this.source="",this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=[],this.history=[],this.ltree=new t.TREE,this.dtree=new t.TREE},this.sltree=new this.TREE,this.sdtree=new this.TREE,this.length_bits=new Array(30),this.length_base=new Array(30),this.dist_bits=new Array(30),this.dist_base=new Array(30),this.clcidx=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],this.build_bits_base=function(t,e,s,i){var r,n;for(r=0;r<s;++r)t[r]=0;for(r=0;r<30-s;++r)t[r+s]=Math.floor(r/s);for(n=i,r=0;r<30;++r)e[r]=n,n+=1<<t[r]},this.build_fixed_trees=function(t,e){var s;for(s=0;s<7;++s)t.table[s]=0;for(t.table[7]=24,t.table[8]=152,t.table[9]=112,s=0;s<24;++s)t.trans[s]=256+s;for(s=0;s<144;++s)t.trans[24+s]=s;for(s=0;s<8;++s)t.trans[168+s]=280+s;for(s=0;s<112;++s)t.trans[176+s]=144+s;for(s=0;s<5;++s)e.table[s]=0;for(e.table[5]=32,s=0;s<32;++s)e.trans[s]=s},this.build_tree=function(t,e,s,i){var r,n,o=new Array(16);for(r=0;r<16;++r)t.table[r]=0;for(r=0;r<i;++r)t.table[e[s+r]]++;for(t.table[0]=0,n=0,r=0;r<16;++r)o[r]=n,n+=t.table[r];for(r=0;r<i;++r)e[s+r]&&(t.trans[o[e[s+r]]++]=r)},this.getbit=function(t){var e;return t.bitcount--||(t.tag=255&t.source[t.sourceIndex++],t.bitcount=7),e=1&t.tag,t.tag>>=1,e},
this.read_bits=function(t,e,s){if(!e)return s;var i=r(t.source,t.bitcount,t.tag,t.sourceIndex,e);return t.bitcount=i[0],t.tag=i[1],t.sourceIndex=i[2],i[3]+s},this.decode_symbol=function(t,e){for(;t.bitcount<16;)t.tag=t.tag|(255&t.source[t.sourceIndex++])<<t.bitcount,t.bitcount+=8;var s=0,i=0,r=0;do{i=2*i+((t.tag&1<<r)>>r),++r,s+=e.table[r],i-=e.table[r]}while(i>=0);return t.tag>>=r,t.bitcount-=r,e.trans[s+i]},this.decode_trees=function(t,e,s){var i,r,n,o,h,a,_=new this.TREE,c=new Array(320);for(i=this.read_bits(t,5,257),r=this.read_bits(t,5,1),n=this.read_bits(t,4,4),o=0;o<19;++o)c[o]=0;for(o=0;o<n;++o){var u=this.read_bits(t,3,0);c[this.clcidx[o]]=u}for(this.build_tree(_,c,0,19),h=0;h<i+r;){var l=this.decode_symbol(t,_);switch(l){case 16:var d=c[h-1];for(a=this.read_bits(t,2,3);a;--a)c[h++]=d;break;case 17:for(a=this.read_bits(t,3,3);a;--a)c[h++]=0;break;case 18:for(a=this.read_bits(t,7,11);a;--a)c[h++]=0;break;default:c[h++]=l}}this.build_tree(e,c,0,i),this.build_tree(s,c,i,r)},this.inflate_block_data=function(t,e,s){for(var i=t.dest,r=i.length;;){var n=this.decode_symbol(t,e);if(256===n)return this.OK;if(n<256)i[r++]=n,t.history.push(n);else{var o,h,a,_;if(n-=257,o=this.read_bits(t,this.length_bits[n],this.length_base[n]),h=this.decode_symbol(t,s),(a=t.history.length-this.read_bits(t,this.dist_bits[h],this.dist_base[h]))<0)throw new Error("Invalid zlib offset "+a);for(_=a;_<a+o;++_)i[r++]=t.history[_],t.history.push(t.history[_])}}},this.inflate_uncompressed_block=function(t){var e,s,i;if(t.bitcount>7){var r=Math.floor(t.bitcount/8);t.sourceIndex-=r,t.bitcount=0,t.tag=0}if(e=t.source[t.sourceIndex+1],e=256*e+t.source[t.sourceIndex],s=t.source[t.sourceIndex+3],s=256*s+t.source[t.sourceIndex+2],e!==(65535&~s))return this.DATA_ERROR;for(t.sourceIndex+=4,i=e;i;--i)t.history.push(t.source[t.sourceIndex]),t.dest[t.dest.length]=t.source[t.sourceIndex++];return t.bitcount=0,this.OK},this.inflate_fixed_block=function(t){return this.inflate_block_data(t,this.sltree,this.sdtree)},this.inflate_dynamic_block=function(t){return this.decode_trees(t,t.ltree,t.dtree),this.inflate_block_data(t,t.ltree,t.dtree)},this.init=function(){this.build_fixed_trees(this.sltree,this.sdtree),this.build_bits_base(this.length_bits,this.length_base,4,3),this.build_bits_base(this.dist_bits,this.dist_base,2,1),this.length_bits[28]=0,this.length_base[28]=258,this.reset()},this.reset=function(){this.d=new this.DATA(this),delete this.header},this.uncompress=function(t,e){var s,i=this.d;i.source=t,i.sourceIndex=e,i.bitcount=0,i.dest=[],void 0===this.header&&(this.header=this.read_bits(i,16,0));var r=0;do{var n;switch(s=this.getbit(i),this.read_bits(i,2,0)){case 0:n=this.inflate_uncompressed_block(i);break;case 1:n=this.inflate_fixed_block(i);break;case 2:n=this.inflate_dynamic_block(i);break;default:return{status:this.DATA_ERROR}}if(n!==this.OK)return{status:this.DATA_ERROR};r++}while(!s&&i.sourceIndex<i.source.length);return i.history=i.history.slice(-this.WINDOW_SIZE),{status:this.OK,data:i.dest}}}function r(t,e,s,i,r){for(var n=0;e<24;)s|=(255&t[i++])<<e,e+=8;return n=s&65535>>16-r,s>>=r,e-=r,[e,s,i,n]}e.exports=i},{}],14:[function(t,e,s){(function(s){function i(t,e,s,i){function r(t){return t?function(s,i){void 0!==i?this["_"+e][i]=t(s):this["_"+e]=t(s)}:function(t,s){void 0!==s?this["_"+e][s]=t:this["_"+e]=t}}var n;n="arr"===i?function(t){return void 0!==t?this["_"+e][t]:this["_"+e]}:function(){return this["_"+e]};var o;if("bool"===i)o=r(function(t){return!(!t||t in{0:1,no:1,false:1})});else if("int"===i)o=r(function(t){return parseInt(t,10)});else if("float"===i)o=r(parseFloat);else if("str"===i)o=r(String);else if("func"===i)o=r(function(t){return t||function(){}});else{if("arr"!==i&&"dom"!==i&&"raw"!==i)throw new Error("unknown property type "+i);o=r()}void 0===t["get_"+e]&&(t["get_"+e]=n),void 0===t["set_"+e]&&("rw"===s?t["set_"+e]=o:"wo"===s&&(t["set_"+e]=function(t,s){if(void 0!==this["_"+e])throw new Error(e+" can only be set once");o.call(this,t,s)})),t["_raw_set_"+e]=function(t,e){o.call(this,t,e)}}var r=t("debug")("noVNC:Util"),n=t("debug")("noVNC:ERROR:Util");n.log=console.warn.bind(console);var o=null,h=e.exports={push8:function(t,e){t.push(255&e)},push16:function(t,e){t.push(e>>8&255,255&e)},push32:function(t,e){t.push(e>>24&255,e>>16&255,e>>8&255,255&e)},requestAnimationFrame:function(){return s.requestAnimationFrame?s.requestAnimationFrame.bind(s):s.webkitRequestAnimationFrame?s.webkitRequestAnimationFrame.bind(s):s.mozRequestAnimationFrame?s.mozRequestAnimationFrame.bind(s):s.oRequestAnimationFrame?s.oRequestAnimationFrame.bind(s):s.msRequestAnimationFrame?s.msRequestAnimationFrame.bind(s):function(t){setTimeout(t,1e3/60)}}(),make_properties:function(t,e){for(var s=0;s<e.length;s++)i(t.prototype,e[s][0],e[s][1],e[s][2])},set_defaults:function(t,e,s){var i,r=Object.keys(s),o=Object.keys(e),h={};for(i=0;i<r.length;i++)h[r[i]]=1;for(i=0;i<o.length;i++)h[o[i]]=1;var a=Object.keys(h);for(i=0;i<a.length;i++){var _=t["_raw_set_"+a[i]];_?a[i]in e?_.call(t,e[a[i]]):_.call(t,s[a[i]]):n("invalid property: %s",a[i])}},decodeUTF8:function(t){return decodeURIComponent(escape(t))},getPosition:function(t){var e=t.getBoundingClientRect();return{x:e.left+window.pageXOffset,y:e.top+window.pageYOffset,width:e.width,height:e.height}},getEventPosition:function(t,e,i,r){var n,o,a,_;void 0===r&&(r=1),n=t||s.event,n=n.changedTouches?n.changedTouches[0]:n.touches?n.touches[0]:n,n.pageX||n.pageY?(o=n.pageX,a=n.pageY,o=n.pageX/r,a=n.pageY/r):(n.clientX||n.clientY)&&(o=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a=n.clientY+document.body.scrollTop+document.documentElement.scrollTop),_=h.getPosition(e),void 0===i&&(i=1);var c=o-_.x,u=a-_.y;return{x:Math.max(Math.min(c,_.width-1),0)/i,y:Math.max(Math.min(u,_.height-1),0)/i,realx:c/i,realy:u/i}},addEvent:function(t,e,s){if(t.attachEvent){return t.attachEvent("on"+e,s)}if(t.addEventListener)return t.addEventListener(e,s,!1),!0;throw new Error("handler could not be attached")},removeEvent:function(t,e,s){if(t.detachEvent){return t.detachEvent("on"+e,s)}if(t.removeEventListener)return t.removeEventListener(e,s,!1),!0;throw new Error("handler could not be removed")},stopEvent:function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1},browserSupportsCursorURIs:function(){if(null===o)try{var t=document.createElement("canvas");t.style.cursor='url("data:image/x-icon;base64,AAACAAEACAgAAAIAAgA4AQAAFgAAACgAAAAIAAAAEAAAAAEAIAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AAAAAAAAAAAAAAAAAAAAAA==") 2 2, default',t.style.cursor?(r("data URI scheme cursor supported"),o=!0):(n("data URI scheme cursor not supported"),o=!1)}catch(t){n("data URI scheme cursor test exception: "+t),o=!1}return o}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:2}],15:[function(t,e,s){(function(s){function i(){this._websocket=null,this._rQ=[],this._rQi=0,this._rQmax=1e4,this._sQ=[],this._mode="base64",this.maxBufferedAmount=200,this._eventHandlers={message:function(){},open:function(){},close:function(){},error:function(){}}}var r=t("debug")("noVNC:Websock"),n=t("debug")("noVNC:ERROR:Websock");n.log=console.warn.bind(console);var o=t("bowser").browser,h=t("./base64");e.exports=i,i.prototype={get_sQ:function(){return this._sQ},get_rQ:function(){return this._rQ},get_rQi:function(){return this._rQi},set_rQi:function(t){this._rQi=t},rQlen:function(){return this._rQ.length-this._rQi},rQpeek8:function(){return this._rQ[this._rQi]},rQshift8:function(){return this._rQ[this._rQi++]},rQskip8:function(){this._rQi++},rQskipBytes:function(t){this._rQi+=t},rQunshift8:function(t){0===this._rQi?this._rQ.unshift(t):(this._rQi--,this._rQ[this._rQi]=t)},rQshift16:function(){return(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]},rQshift32:function(){return(this._rQ[this._rQi++]<<24)+(this._rQ[this._rQi++]<<16)+(this._rQ[this._rQi++]<<8)+this._rQ[this._rQi++]},rQshiftStr:function(t){void 0===t&&(t=this.rQlen());var e=this._rQ.slice(this._rQi,this._rQi+t);return this._rQi+=t,String.fromCharCode.apply(null,e)},rQshiftBytes:function(t){return void 0===t&&(t=this.rQlen()),this._rQi+=t,this._rQ.slice(this._rQi-t,this._rQi)},rQslice:function(t,e){return e?this._rQ.slice(this._rQi+t,this._rQi+e):this._rQ.slice(this._rQi+t)},rQwait:function(t,e,s){if(this._rQ.length-this._rQi<e){if(s){if(this._rQi<s)throw new Error("rQwait cannot backup "+s+" bytes");this._rQi-=s}return!0}return!1},flush:function(){return 0!==this._websocket.bufferedAmount&&r("flush() | bufferedAmount: %d",this._websocket.bufferedAmount),this._websocket.bufferedAmount<this.maxBufferedAmount?(this._sQ.length>0&&(this._websocket.send(this._encode_message()),this._sQ=[]),!0):(r("flush() | delaying send"),!1)},send:function(t){return this._sQ=this._sQ.concat(t),this.flush()},send_string:function(t){this.send(t.split("").map(function(t){return t.charCodeAt(0)}))},on:function(t,e){this._eventHandlers[t]=e},off:function(t){this._eventHandlers[t]=function(){}},init:function(t){this._rQ=[],this._rQi=0,this._sQ=[],this._websocket=null;"Uint8Array"in s&&Uint8Array.prototype;var e=!1;if(s.WebSocket&&(o.safari&&Number(o.version)>0&&Number(o.version)<7?r("init() | Safari %d does not support binary WebSocket",Number(o.version)):e=!0),void 0===t&&(t=e?["binary","base64"]:"base64"),!e){if("binary"===t)throw new Error("WebSocket binary sub-protocol requested but not supported");if("object"==typeof t){for(var i=[],h=0;h<t.length;h++)"binary"===t[h]?n("init() | skipping unsupported WebSocket binary sub-protocol"):i.push(t[h]);if(!(i.length>0))throw new Error("only WebSocket binary sub-protocol was requested and is not supported");t=i}}return t},open:function(t,e){var i=this;e=this.init(e),s.NativeWebSocket?(r("open() | using NativeWebSocket"),this._websocket=new s.NativeWebSocket(t,e)):(r("open() | not using NativeWebSocket"),this._websocket=new WebSocket(t,e)),e.indexOf("binary")>=0&&(this._websocket.binaryType="arraybuffer"),this._websocket.onmessage=function(t){i._recv_message(t)},this._websocket.onopen=function(){i._websocket.protocol?(r('onopen: server choose "%s" sub-protocol',i._websocket.protocol),i._mode=i._websocket.protocol,i._eventHandlers.open()):(n('onopen: server choose no sub-protocol, using "base64"'),i._mode="base64",i._eventHandlers.open())},this._websocket.onclose=function(t){r("onclose: %o",t),i._eventHandlers.close(t)},this._websocket.onerror=function(t){n("onerror: %o",t),i._eventHandlers.error(t)}},close:function(){this._websocket&&(this._websocket.readyState!==this._websocket.OPEN&&this._websocket.readyState!==this._websocket.CONNECTING||(r("close()"),this._websocket.close()),this._websocket.onmessage=function(){})},_encode_message:function(){return"binary"===this._mode?new Uint8Array(this._sQ).buffer:h.encode(this._sQ)},_decode_message:function(t){if("binary"===this._mode)for(var e=new Uint8Array(t),s=0;s<e.length;s++)this._rQ.push(e[s]);else this._rQ=this._rQ.concat(h.decode(t,0))},_recv_message:function(t){try{this._decode_message(t.data),this.rQlen()>0?(this._eventHandlers.message(),this._rQ.length>this._rQmax&&(this._rQ=this._rQ.slice(this._rQi),this._rQi=0)):r("_recv_message() | ignoring empty message")}catch(t){n("_recv_message() | error: %o",t),void 0!==t.name?this._eventHandlers.error(t.name+": "+t.message):this._eventHandlers.error(t)}}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./base64":6,bowser:1,debug:2}],16:[function(t,e,s){function i(){}var r=e.exports={};r.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var s=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),s.length>0)){s.shift()()}},!0),function(t){s.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=i,r.addListener=i,r.once=i,r.off=i,r.removeListener=i,r.removeAllListeners=i,r.emit=i,r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")}},{}],17:[function(t,e,s){function i(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]}var r=t("novnc-node"),n=t("./reactor");!function(t){var e={},s=null;e.EV_SET_AUTH_TOKEN="setAuthToken",e.EV_FETCH_AUTH_TOKEN="fetchAuthToken",e.EV_FETCH_AUTH_TOKEN_ERROR="fetchAuthTokenError",e.EV_RA_ATTRS_LOAD="raAttrsLoad",e.EV_INIT_ERROR="initError",e.EV_RA_ATTRS_ERROR="raAttrsError",e.init=function(t){e.settings=i({authToken:null,authTokenURL:null,onAuthTokenRequest:null,url:"https://catvision.io"},t),e.authTokenRequested=!1,e.reactor=new n},e.setAuthToken=function(t){e.settings.authToken=t,e.reactor.dispatchEvent(e.EV_SET_AUTH_TOKEN),setTimeout(function(){e.settings.authTokenRequested=!1},200)},e.requestAuthToken=function(){if(!e.authTokenRequested)if(e.authTokenRequested=!0,null!=e.settings.onAuthTokenRequest)e.settings.onAuthTokenRequest();else{if(!e.settings.authTokenURL)throw"Auth token requested but couln't be fetched by any means.";e.fetchAuthToken(function(t){e.setAuthToken(t)},function(){e.authTokenRequested=!1,e.reactor.dispatchEvent(e.EV_FETCH_AUTH_TOKEN_ERROR)})}},e.fetchAuthToken=function(t,s){var i=new XMLHttpRequest;i.open("GET",e.settings.authTokenURL,!0),void 0!=s&&(i.onerror=s),i.onload=function(){200==i.status?t(i.response):s()},i.send("load")},s=function(s){if(this.rfb=null,this.raAttrs=null,this.connecting=!1,this.settings=i({target:null,deviceHandle:null,deviceHandleKey:"t",raAttrsTimeout:5e3,retryDelay:2e3,password:"",connectOnInit:!0},s),this.RFBSettings={target:this.settings.target,encrypt:"https:"===t.location.protocol,repeaterID:"",true_color:!0,local_cursor:!0,shared:!0,view_only:!1,onPasswordRequired:function(){return this.settings.password}.bind(this),onUpdateState:function(t,e,s){this.onRFBUpdateState(t,e,s)}.bind(this)},null==this.settings.target)throw"CVIO Screen target element does not exist.";if(null==this.settings.deviceHandle)throw"Device ID is missing.";this.reactor=new n,e.reactor.addEventListener(e.EV_SET_AUTH_TOKEN,function(){this.connecting&&this.connect()},this)},s.EV_UPDATE_STATE="raUpdateState",s.EV_CONNECT="connect",s.EV_CONNECT_ERROR="connectError",s.prototype.on=function(t,e,s){this.reactor.addEventListener(t,e,s)},s.prototype.raFetchAttrs=function(t,s,i){var r="";r+=e.settings.url+"/api/ra/endpoint",r+="?"+this.settings.deviceHandleKey+"="+this.settings.deviceHandle;var n=new XMLHttpRequest;n.open("GET",r,!0),n.setRequestHeader("X-SC-AuthToken",e.settings.authToken),void 0!=i&&(n.onerror=i),n.onload=function(){200==n.status?t(JSON.parse(n.response)):403==n.status?s():i()},n.send("load")},s.prototype.requestRaAttrs=function(t){if(null==e.settings.authToken)return void e.requestAuthToken();var s=this;this.requestedRaAttrs=!0,this.raFetchAttrs(function(t){s.raAttrs=t,s.requestedRaAttrs=!1,s.connecting&&s.connect()},function(){e.requestAuthToken()},function(){throw"Can't fetch RA attributes."}),setTimeout(function(){s.requestedRaAttrs&&t(),s.requestedRaAttrs=!1},this.settings.raAttrsTimeout)},s.prototype.connect=function(){if(this.connecting=!0,null==this.raAttrs)return void this.requestRaAttrs(function(){this.connecting=!1,this.reactor.dispatchEvent(s.EV_CONNECT_ERROR,"raAttrsTimeout")}.bind(this));if(!this.raAttrs.established)return this.raAttrs=null,this.connecting=!1,void this.reactor.dispatchEvent(s.EV_CONNECT_ERROR,"clientNotEstablished");try{this.rfb=new r.RFB(this.RFBSettings)}catch(t){return void this.reactor.dispatchEvent(s.EV_CONNECT_ERROR,t)}var e="ws://";"https:"!=t.location.protocol&&!0!==this.raAttrs.link.ssl_only||(e="wss://");var i="";i+=e,i+=this.raAttrs.link.ws_host+":"+this.raAttrs.link.ws_port,i+="/"+this.raAttrs.link.client_id+"/"+this.raAttrs.link.gw_ip,i+="?cvio_nonce="+this.raAttrs.link.nonce,this.rfb.connect(i,""),this.connecting=!1},s.prototype.disconnect=function(){this.connecting=!1,this.rfb.disconnect()},s.prototype.onRFBUpdateState=function(t,e,i){this.reactor.dispatchEvent(s.EV_UPDATE_STATE,e,i),"normal"==e&&"ServerInitialisation"==i?this.reactor.dispatchEvent(s.EV_CONNECT):"disconnect"==e&&"connecting"==i&&this.reactor.dispatchEvent(s.EV_CONNECT_ERROR,"clientUnavailable")},t.CVIO=e,t.CVIODisplay=s}(window)},{"./reactor":18,"novnc-node":5}],18:[function(t,e,s){var i=function(t,e){this.callback=t,this.self=e,void 0==this.self&&(this.self=null)};i.prototype.execute=function(){this.callback.apply(this.self,arguments)};var r=function(t){this.name=t,this.callbacks=[]};r.prototype.reset=function(){this.callbacks=[]};var n=function(){this.events={}};n.prototype.addEventListener=function(t,e,s){void 0==this.events[t]&&(this.events[t]=new r(t)),this.events[t].callbacks.push(new i(e,s))},n.prototype.dispatchEvent=function(t){var e=this,s=Array.prototype.slice.call(arguments,1);if(void 0!=this.events[t])for(x in this.events[t].callbacks)setTimeout(function(){e.events[t].callbacks[x].execute.apply(e.events[t].callbacks[x],s)},0)},n.prototype.resetEvent=function(t){this.events[t]&&this.events[t].reset()},e.exports=n},{}]},{},[17]);